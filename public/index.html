<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiele √úbersicht</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: #0a0e27;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.4) 0%, transparent 70%);
            top: -200px;
            left: -200px;
            border-radius: 50%;
            filter: blur(80px);
            animation: float 20s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: absolute;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%);
            bottom: -250px;
            right: -250px;
            border-radius: 50%;
            filter: blur(100px);
            animation: float 25s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(100px, 100px) scale(1.1); }
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            z-index: 10;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 8px;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.7;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .games-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 24px;
            width: 73%;
            flex: 1;
            max-height: 850px;
            z-index: 10;
        }

        .players-section {
            width: 24%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        .players-header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 16px;
        }

        .players-header h2 {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .add-player-form {
            display: flex;
            gap: 8px;
        }

        .add-player-form input {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 10px 12px;
            color: #ffffff;
            font-size: 0.85rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .add-player-form input::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.8rem;
        }

        .add-player-form input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .add-player-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            border: none;
            border-radius: 10px;
            padding: 10px 14px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.8rem;
        }

        .add-player-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
        }

        .add-player-btn:active {
            transform: translateY(0);
        }

        .players-list {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 16px;
            flex: 1;
            overflow-y: auto;
            max-height: 700px;
        }

        .players-list::-webkit-scrollbar {
            width: 6px;
        }

        .players-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .players-list::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 10px;
        }

        .players-list::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.7);
        }

        .player-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateX(4px);
        }

        .player-rank {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.95rem;
            flex-shrink: 0;
        }

        .player-rank.first {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.4);
        }

        .player-rank.second {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            box-shadow: 0 4px 16px rgba(148, 163, 184, 0.4);
        }

        .player-rank.third {
            background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);
            box-shadow: 0 4px 16px rgba(251, 146, 60, 0.4);
        }

        .player-info {
            flex: 1;
            min-width: 0;
        }

        .player-name {
            color: #ffffff;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-score {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
        }

        .player-score-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 6px 8px;
            color: #ffffff;
            font-size: 0.85rem;
            width: 60px;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .player-score-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .delete-player-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 6px;
            color: #f87171;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .delete-player-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.5);
        }

        .content-wrapper {
            display: flex;
            gap: 30px;
            width: 100%;
            max-width: 1800px;
            flex: 1;
            max-height: 850px;
        }

        .empty-state {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            padding: 30px 15px;
            font-size: 0.85rem;
        }

        .game-button {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        .game-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .game-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0;
            transform: scale(0);
            transition: all 0.6s ease;
        }

        .game-button:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 20px 60px rgba(124, 58, 237, 0.3),
                0 0 80px rgba(59, 130, 246, 0.2),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .game-button:hover::before {
            opacity: 1;
        }

        .game-button:hover::after {
            opacity: 1;
            transform: scale(1);
        }

        .game-button:active {
            transform: translateY(-4px) scale(0.98);
        }

        .game-icon {
            font-size: 4rem;
            margin-bottom: 8px;
            filter: drop-shadow(0 4px 20px rgba(124, 58, 237, 0.4));
            transition: all 0.4s ease;
        }

        .game-button:hover .game-icon {
            transform: scale(1.1) rotateZ(5deg);
            filter: drop-shadow(0 8px 30px rgba(124, 58, 237, 0.6));
        }

        .game-number {
            position: absolute;
            top: 16px;
            right: 16px;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 4px 16px rgba(124, 58, 237, 0.4);
            transition: all 0.3s ease;
        }

        .game-button:hover .game-number {
            transform: scale(1.1);
            box-shadow: 0 6px 24px rgba(124, 58, 237, 0.6);
        }

        .game-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #ffffff;
            text-align: center;
            letter-spacing: -0.5px;
            transition: all 0.3s ease;
        }

        .game-button:hover .game-title {
            color: #a78bfa;
        }

        .game-description {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            line-height: 1.4;
            font-weight: 300;
        }

        .game-status {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .game-status.configured {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border-color: rgba(34, 197, 94, 0.3);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            position: relative;
            width: calc(100vw - 20px);
            height: calc(100vh - 20px);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .modal-icon {
            font-size: 3rem;
            filter: drop-shadow(0 4px 20px rgba(124, 58, 237, 0.4));
        }

        .modal-title h2 {
            color: #ffffff;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .modal-close {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            color: #f87171;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.5);
            transform: translateY(-2px);
        }

        .modal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow: hidden;
        }

        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.7);
        }

        .config-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
        }

        .config-section h3 {
            color: #ffffff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .config-section p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .config-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .config-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .config-item label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 500;
            display: block;
            margin-bottom: 8px;
        }

        .config-item input,
        .config-item select,
        .config-item textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 12px 16px;
            color: #ffffff;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .config-item input:focus,
        .config-item select:focus,
        .config-item textarea:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .config-item textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .save-config-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            align-self: flex-start;
            margin-top: 10px;
        }

        .save-config-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
        }

        .save-config-btn:active {
            transform: translateY(0);
        }

        /* Wer bin ich - Upload Styles */
        .upload-area {
            margin-top: 15px;
        }

        .upload-placeholder {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: rgba(255, 255, 255, 0.7);
        }

        .upload-placeholder:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #7c3aed;
        }

        /* Wer bin ich - Game View Styles */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
        }

        .info-card h3 {
            color: #ffffff;
            font-weight: 600;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 1rem;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .info-value {
            color: #ffffff;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .timer-value {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.5rem;
        }

        .control-btn-full {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 14px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95rem;
            text-align: left;
        }

        .control-btn-full:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
        }

        .control-btn-full:active {
            transform: translateX(2px);
        }

        .control-btn-full.danger {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .control-btn-full.danger:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
        }

        .image-display-large {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #gameCanvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }

        .round-complete-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 30px;
            z-index: 10;
            border-radius: 16px;
        }

        .round-complete-overlay.active {
            display: flex;
        }

        .round-complete-message {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .next-round-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            border: none;
            border-radius: 16px;
            padding: 20px 60px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            font-size: 1.4rem;
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
        }

        .next-round-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(124, 58, 237, 0.6);
        }

        .next-round-btn:active {
            transform: translateY(-2px);
        }

        /* Spieler-Liste im Spiel */
        .game-player-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .game-player-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .game-player-name {
            color: #ffffff;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .game-player-score {
            color: #7c3aed;
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Rundengewinner Auswahl */
        .winner-selection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 30px;
            z-index: 20;
            border-radius: 16px;
            padding: 40px;
        }

        .winner-selection-overlay.active {
            display: flex;
        }

        .winner-title {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }

        .winner-players {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 800px;
        }

        .winner-player-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .winner-player-btn:hover {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
        }

        .no-winner-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 16px 32px;
            color: #f87171;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
        }

        .no-winner-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.5);
        }

        /* Endergebnis */
        .final-results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
        }

        .final-results h3 {
            color: #ffffff;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .final-player-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .final-player-item.winner {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: #7c3aed;
        }

        .final-player-rank {
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .final-player-name {
            flex: 1;
            color: #ffffff;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .final-player-score {
            color: #7c3aed;
            font-weight: 700;
            font-size: 1.3rem;
        }

        /* Turnierbaum Styles f√ºr Spiel 3 */
        .tournament-container {
            display: flex;
            flex-direction: row;
            gap: 40px;
            padding: 30px;
            overflow-x: auto;
            overflow-y: hidden;
            align-items: center;
            justify-content: center;
            min-height: 600px;
        }

        .tournament-round {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 280px;
        }

        .tournament-round-title {
            color: #ffffff;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tournament-matches {
            display: flex;
            flex-direction: column;
            gap: 30px;
            justify-content: space-around;
            flex: 1;
        }

        .tournament-match {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }

        .tournament-match::after {
            content: '';
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, rgba(124, 58, 237, 0.5) 0%, transparent 100%);
        }

        .tournament-round:last-child .tournament-match::after {
            display: none;
        }

        .match-player {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 50px;
        }

        .match-player:hover {
            background: rgba(124, 58, 237, 0.2);
            border-color: #7c3aed;
            transform: translateX(3px);
        }

        .match-player.winner {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.4) 0%, rgba(59, 130, 246, 0.4) 100%);
            border-color: #7c3aed;
            border-width: 3px;
        }

        .match-player.eliminated {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .match-player.eliminated:hover {
            transform: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .match-player-name {
            color: #ffffff;
            font-size: 1rem;
            font-weight: 600;
        }

        .match-player-status {
            font-size: 1.3rem;
        }

        .match-vs {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 700;
            font-size: 0.9rem;
            margin: 3px 0;
        }

        .tournament-champion {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 2px solid rgba(124, 58, 237, 0.5);
        }

        .champion-trophy {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: championPulse 2s ease-in-out infinite;
        }

        @keyframes championPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .champion-name {
            color: #ffffff;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .champion-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.2rem;
        }

        /* Sch√§tzen-Spiel Styles (Spiel 5) */
        .estimate-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 80px 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .estimate-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.1) 0%, transparent 70%);
            animation: rotateBg 20s linear infinite;
        }

        @keyframes rotateBg {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .estimate-round-number {
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            z-index: 1;
        }

        .estimate-round-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 2rem;
            font-weight: 600;
            z-index: 1;
        }

        .round-input-container {
            margin-top: 20px;
        }

        .round-input-container label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 600;
            display: block;
            margin-bottom: 15px;
        }

        .round-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px 20px;
            color: #ffffff;
            font-size: 1.5rem;
            text-align: center;
            width: 150px;
            outline: none;
            transition: all 0.3s ease;
        }

        .round-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #7c3aed;
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.2);
        }

        /* Cantina Band Styles (Spiel 2) */
        .audio-player-container {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .audio-visualizer {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            position: relative;
            overflow: hidden;
        }

        .audio-visualizer.playing::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(124, 58, 237, 0.3) 50%, 
                transparent 100%);
            animation: audioWave 2s linear infinite;
        }

        @keyframes audioWave {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        .audio-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .audio-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 2rem;
        }

        .audio-btn:hover {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
            transform: scale(1.1);
        }

        .audio-btn.primary {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            border: none;
        }

        .audio-btn.primary:hover {
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.6);
        }

        .audio-timeline {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .audio-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .audio-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #7c3aed 0%, #3b82f6 100%);
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        .audio-time-display {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .song-title-display {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }

        /* Start Screen */
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s, visibility 0.5s;
        }

        #startScreen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .start-logo {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            object-fit: cover;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .start-title {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-align: center;
        }

        .start-subtitle {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 50px;
            text-align: center;
        }

        .lets-go-btn {
            padding: 20px 60px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.4);
            position: relative;
            overflow: hidden;
        }

        .lets-go-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .lets-go-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .lets-go-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(124, 58, 237, 0.6);
        }

        .lets-go-btn:active {
            transform: translateY(-2px);
        }

        .lets-go-btn span {
            position: relative;
            z-index: 1;
        }

        #mainContent {
            opacity: 0;
            transition: opacity 0.5s;
        }

        #mainContent.visible {
            opacity: 1;
        }

        /* Jeans Production Animation Screen */
        #animationScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s;
        }

        #animationScreen.active {
            opacity: 1;
            visibility: visible;
        }

        #animationScreen.fadeout {
            opacity: 0;
            visibility: hidden;
        }

        .production-text {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            opacity: 0;
            animation: fadeInScale 1.5s ease-out forwards;
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: sparkleAnimation 2s ease-in-out infinite;
        }

        @keyframes sparkleAnimation {
            0%, 100% {
                opacity: 0;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .sparkle:nth-child(1) { top: 20%; left: 20%; animation-delay: 0s; }
        .sparkle:nth-child(2) { top: 30%; right: 25%; animation-delay: 0.3s; }
        .sparkle:nth-child(3) { bottom: 25%; left: 30%; animation-delay: 0.6s; }
        .sparkle:nth-child(4) { bottom: 30%; right: 20%; animation-delay: 0.9s; }
        .sparkle:nth-child(5) { top: 50%; left: 15%; animation-delay: 1.2s; }
        .sparkle:nth-child(6) { top: 60%; right: 18%; animation-delay: 1.5s; }

        .glow-circle {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse-glow 3s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.6;
            }
        }

        /* El Finale Card Animations */
        @keyframes cardZoomIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes cardZoomOut {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0.5);
                opacity: 0;
            }
        }

        .card-zoom-in {
            animation: cardZoomIn 0.3s ease-out forwards;
        }

        .card-zoom-out {
            animation: cardZoomOut 0.25s ease-in forwards;
        }

        /* Higher or Lower Drag & Drop */
        .dragging {
            opacity: 0.5;
            cursor: grabbing !important;
        }

        .drag-over {
            background: rgba(124, 58, 237, 0.2) !important;
            border-color: rgba(124, 58, 237, 0.8) !important;
        }

        .company-card {
            cursor: grab;
            user-select: none;
        }

        .company-card:active {
            cursor: grabbing;
        }

        .drop-indicator {
            width: 4px;
            height: 100px;
            background: #7c3aed;
            border-radius: 2px;
            position: absolute;
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(124, 58, 237, 0.5);
        }

        /* Higher or Lower Feedback Modal */
        .feedback-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1f3a 0%, #0a0e27 100%);
            border-radius: 20px;
            padding: 60px 80px;
            z-index: 10001;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            text-align: center;
            min-width: 400px;
        }

        .feedback-correct {
            border: 4px solid #22c55e;
            box-shadow: 0 20px 60px rgba(34, 197, 94, 0.5);
        }

        .feedback-wrong {
            border: 4px solid #ef4444;
            box-shadow: 0 20px 60px rgba(239, 68, 68, 0.5);
        }

        .feedback-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .feedback-text {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 15px;
        }

        .feedback-details {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }

        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
        }

        /* Flying Emojis */
        .flying-emoji {
            position: absolute;
            font-size: 2.5rem;
            opacity: 0.4;
            pointer-events: none;
            animation: rainDown 8s linear infinite;
            top: -100px; /* Starte au√üerhalb des sichtbaren Bereichs */
        }

        @keyframes rainDown {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(calc(100vh + 200px)) rotate(180deg);
                opacity: 0;
            }
        }

        /* Verschiedene horizontale Positionen und Verz√∂gerungen */
        .flying-emoji:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 7s; }
        .flying-emoji:nth-child(2) { left: 25%; animation-delay: 2s; animation-duration: 9s; }
        .flying-emoji:nth-child(3) { left: 45%; animation-delay: 4s; animation-duration: 8s; }
        .flying-emoji:nth-child(4) { left: 65%; animation-delay: 1s; animation-duration: 10s; }
        .flying-emoji:nth-child(5) { left: 80%; animation-delay: 3s; animation-duration: 8.5s; }
        .flying-emoji:nth-child(6) { left: 90%; animation-delay: 5s; animation-duration: 9.5s; }

        /* Buzzer Icon f√ºr Spielregeln */
        .buzzer-icon {
            width: 80px;
            height: auto;
            background-image: url('/mnt/user-data/uploads/Game_Buzzer_PNG.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen">
        <!-- Flying Emojis -->
        <div class="flying-emoji">üö¨</div>
        <div class="flying-emoji">üç∫</div>
        <div class="flying-emoji">ü•É</div>
        <div class="flying-emoji">üö¨</div>
        <div class="flying-emoji">üçª</div>
        <div class="flying-emoji">üç∑</div>
        
        <img src="Logo/quiz-show-logo.jpg" alt="Quiz Show Logo" class="start-logo">
        <h1 class="start-title">üéÆ Quiz Show</h1>
        <p class="start-subtitle">Letzte Chance!!! Raucht und holt euch ein Kaltgetr√§nk!!!</p>
        <button class="lets-go-btn" onclick="startQuizShow()">
            <span>Let's go! üöÄ</span>
        </button>
    </div>

    <!-- Background Music -->
    <audio id="backgroundMusic">
        <!-- Source wird dynamisch gesetzt -->
    </audio>

    <!-- Jeans Production Animation -->
    <div id="animationScreen">
        <div class="glow-circle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <h1 class="production-text">Jeans Production</h1>
    </div>

    <!-- Main Content -->
    <div id="mainContent">
    <div class="header">
        <img src="Logo/quiz-show-logo.jpg" alt="Quiz Show Logo" style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3); object-fit: cover;">
        <h1>üéÆ Spiele √úbersicht</h1>
    </div>

    <div class="content-wrapper">
        <div class="games-container">
        <button class="game-button" onclick="selectGame(1)">
            <div class="game-number">1</div>
            <div class="game-icon">üòé</div>
            <div class="game-title">Wer zum Teufel bin ich?</div>
        </button>

        <button class="game-button" onclick="selectGame(2)">
            <div class="game-number">2</div>
            <div class="game-icon">üéµ</div>
            <div class="game-title">Cantina Band</div>
        </button>

        <button class="game-button" onclick="selectGame(3)">
            <div class="game-number">3</div>
            <div class="game-icon">üéØ</div>
            <div class="game-title">Gezinkter Pfeil!</div>
        </button>

        <button class="game-button" onclick="selectGame(4)">
            <div class="game-number">4</div>
            <div class="game-icon">üìä</div>
            <div class="game-title">Higher or Lower?</div>
        </button>

        <button class="game-button" onclick="selectGame(5)">
            <div class="game-number">5</div>
            <div class="game-icon">ü§î</div>
            <div class="game-title">Sch√§tzen, sch√§tzen und raten</div>
        </button>

        <button class="game-button" onclick="selectGame(6)">
            <div class="game-number">6</div>
            <div class="game-icon">ü•§</div>
            <div class="game-title">Einlochen!</div>
        </button>

        <button class="game-button" onclick="selectGame(7)">
            <div class="game-number">7</div>
            <div class="game-icon">üî®</div>
            <div class="game-title">Auktionshaus</div>
        </button>

        <button class="game-button" onclick="selectGame(8)">
            <div class="game-number">8</div>
            <div class="game-icon">üåç</div>
            <div class="game-title">Auslandsmaus Jeans</div>
        </button>

        <button class="game-button" onclick="selectGame(9)">
            <div class="game-number">9</div>
            <div class="game-icon">üèÜ</div>
            <div class="game-title">EL FINALE</div>
        </button>
    </div>

    <div class="players-section">
        <div class="players-header">
            <h2>üèÜ Spieler</h2>
            <div class="add-player-form">
                <input type="text" id="playerNameInput" placeholder="Spielername eingeben..." maxlength="30">
                <button class="add-player-btn" onclick="addPlayer()">+ Hinzuf√ºgen</button>
            </div>
        </div>

        <div class="players-list" id="playersList">
            <div class="empty-state">
                Noch keine Spieler hinzugef√ºgt.<br>
                F√ºge Spieler hinzu, um zu beginnen!
            </div>
        </div>
    </div>
</div>
    </div> <!-- End of mainContent -->

    <!-- Modal f√ºr Spiel 1: Wer bin ich -->
    <div class="modal-overlay" id="gameModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="modal-icon" id="modalIcon">üòé</span>
                    <h2 id="modalTitle">Wer zum Teufel bin ich?</h2>
                </div>
                <button class="modal-close" onclick="closeModal()">‚úï Schlie√üen</button>
            </div>
            
            <div class="modal-body" id="modalBody">
                <!-- Spielregeln-Ansicht -->
                <div id="rulesView" style="display: none;">
                    <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                        <!-- Buzzer Icon oben rechts -->
                        <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;">
                            <img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;">
                        </div>
                        
                        <div style="font-size: 4rem; margin-bottom: 20px;">üòé</div>
                        <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Wer zum Teufel bin ich?</h2>
                        
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                            <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                            <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                                <li style="margin-bottom: 12px;">‚úÖ Ein verpixeltes Bild wird angezeigt - welcher Promi ist es?</li>
                                <li style="margin-bottom: 12px;">‚úÖ Innerhalb von 30 Sekunden wird das Bild immer klarer</li>
                                <li style="margin-bottom: 12px;">‚úÖ Wer die Antwort wei√ü, dr√ºckt den Buzzer - der Timer wird gestoppt</li>
                                <li style="margin-bottom: 12px;">‚úÖ Bei falscher Antwort scheidet der Spieler aus - die Runde geht f√ºr alle anderen weiter</li>
                            </ul>
                        </div>

                        <button class="save-config-btn" onclick="acceptRules()" style="font-size: 1.2rem; padding: 18px 50px;">
                            ‚úì Verstanden, weiter!
                        </button>
                    </div>
                </div>

                <!-- Upload-Ansicht -->
                <div id="uploadView" style="display: none;">
                    <div class="config-section">
                        <h3>Bilder hochladen</h3>
                        <p>Lade bis zu 10 Bilder hoch. Jedes Bild wird eine Runde sein.</p>
                        
                        <div class="upload-area" id="uploadArea">
                            <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-placeholder" onclick="document.getElementById('imageInput').click()">
                                <div style="font-size: 3rem; margin-bottom: 10px;">üìÅ</div>
                                <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 5px;">Bilder hochladen</div>
                                <div style="font-size: 0.9rem; opacity: 0.7;">Klicken oder Bilder hierher ziehen (max. 10)</div>
                                <div id="uploadCount" style="margin-top: 15px; font-size: 1.1rem; font-weight: 600; color: #7c3aed;">0 Bilder hochgeladen</div>
                            </div>
                        </div>
                        
                        <button class="save-config-btn" onclick="showGameStart()" id="startGameBtn" style="display: none;">
                            ‚ñ∂Ô∏è Weiter zum Spiel
                        </button>
                    </div>
                </div>

                <!-- Start-Ansicht -->
                <div id="startView" style="display: none;">
                    <div class="config-section" style="text-align: center; padding: 80px 40px;">
                        <h3 style="font-size: 2.5rem; margin-bottom: 20px;">Bereit zum Spielen?</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">
                            <span id="totalImages">0</span> Bilder wurden hochgeladen
                        </p>
                        <p style="font-size: 1rem; opacity: 0.7; margin-bottom: 40px;">
                            Jede Runde dauert 30 Sekunden
                        </p>
                        <button class="save-config-btn" onclick="startGame()" style="font-size: 1.3rem; padding: 20px 50px;">
                            üéÆ Spiel starten!
                        </button>
                    </div>
                </div>

                <!-- Spiel-Ansicht -->
                <div id="gameView" style="display: none;">
                    <div style="display: flex; gap: 20px; height: 100%;">
                        <!-- Linke Sidebar mit Infos und Controls -->
                        <div style="width: 350px; display: flex; flex-direction: column; gap: 15px;">
                            <!-- Rundeninformation -->
                            <div class="info-card">
                                <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üìä Spielinfo</h3>
                                <div class="info-row">
                                    <span class="info-label">Aktuelle Runde:</span>
                                    <span class="info-value" id="currentRound">1</span> / <span id="totalRounds">0</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Verbleibende Zeit:</span>
                                    <span class="info-value timer-value" id="timer">30</span>s
                                </div>
                            </div>

                            <!-- Controls -->
                            <div class="info-card">
                                <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üéÆ Steuerung</h3>
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <button class="control-btn-full" onclick="pauseGame()" id="pauseBtn">
                                        ‚è∏Ô∏è Pause
                                    </button>
                                    <button class="control-btn-full" onclick="skipRound()">
                                        ‚è≠Ô∏è Runde √ºberspringen
                                    </button>
                                    <button class="control-btn-full" onclick="resetRound()">
                                        üîÑ Runde neu starten
                                    </button>
                                    <button class="control-btn-full danger" onclick="endGame()">
                                        üèÅ Spiel beenden
                                    </button>
                                </div>
                            </div>

                            <!-- Spieler und Punkte -->
                            <div class="info-card">
                                <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üë• Spieler</h3>
                                <div id="gamePlayersList" style="max-height: 300px; overflow-y: auto;">
                                    <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
                                        Keine Spieler ausgew√§hlt
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rechter Bereich mit gro√üem Bild -->
                        <div style="flex: 1; display: flex; flex-direction: column; position: relative;">
                            <div class="image-display-large">
                                <canvas id="gameCanvas"></canvas>
                                
                                <!-- Zeit abgelaufen Overlay -->
                                <div class="round-complete-overlay" id="roundCompleteOverlay">
                                    <div class="round-complete-message">‚è±Ô∏è Zeit abgelaufen!</div>
                                    <button class="next-round-btn" onclick="showWinnerSelection()">Gewinner ausw√§hlen ‚ñ∂Ô∏è</button>
                                </div>

                                <!-- Gewinner Auswahl Overlay -->
                                <div class="winner-selection-overlay" id="winnerSelectionOverlay">
                                    <div class="winner-title">üèÜ Wer hat diese Runde gewonnen?</div>
                                    <div class="winner-players" id="winnerPlayersList"></div>
                                    <button class="no-winner-btn" onclick="selectWinner(null)">Niemand hat gewonnen</button>
                                </div>

                                <!-- Endergebnis Overlay -->
                                <div class="winner-selection-overlay" id="finalResultsOverlay">
                                    <div class="final-results">
                                        <h3>üéâ Spielende - Ergebnisse</h3>
                                        <div id="finalResultsList"></div>
                                    </div>
                                    <button class="next-round-btn" onclick="closeModal()" style="margin-top: 20px;">Zur√ºck zur √úbersicht</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Spieler-Daten
        let players = [];

        // LocalStorage Funktionen
        function savePlayers() {
            localStorage.setItem('quizShowPlayers', JSON.stringify(players));
        }

        function loadPlayers() {
            const saved = localStorage.getItem('quizShowPlayers');
            if (saved) {
                players = JSON.parse(saved);
                return true;
            }
            return false;
        }

        // Spieler hinzuf√ºgen
        function addPlayer() {
            const input = document.getElementById('playerNameInput');
            const name = input.value.trim();
            
            if (name === '') {
                alert('Bitte gib einen Spielernamen ein!');
                return;
            }

            // Pr√ºfen ob Name bereits existiert
            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                alert('Dieser Spielername existiert bereits!');
                return;
            }

            // Spieler hinzuf√ºgen
            players.push({
                name: name,
                score: 0
            });

            // Input leeren
            input.value = '';

            // Speichern und Liste aktualisieren
            savePlayers();
            updatePlayersList();
        }

        // Spieler l√∂schen
        function deletePlayer(index) {
            if (confirm(`M√∂chtest du ${players[index].name} wirklich l√∂schen?`)) {
                players.splice(index, 1);
                savePlayers();
                updatePlayersList();
            }
        }

        // Punkte aktualisieren
        function updateScore(index, newScore) {
            const score = parseInt(newScore) || 0;
            players[index].score = score;
            savePlayers();
            updatePlayersList();
        }

        // Spielerliste aktualisieren
        function updatePlayersList() {
            const listContainer = document.getElementById('playersList');
            
            if (players.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        Noch keine Spieler hinzugef√ºgt.<br>
                        F√ºge Spieler hinzu, um zu beginnen!
                    </div>
                `;
                return;
            }

            // Spieler nach Punkten sortieren
            const sortedPlayers = [...players].sort((a, b) => b.score - a.score);

            // HTML generieren
            listContainer.innerHTML = sortedPlayers.map((player, index) => {
                const originalIndex = players.findIndex(p => p.name === player.name);
                let rankClass = '';
                if (index === 0) rankClass = 'first';
                else if (index === 1) rankClass = 'second';
                else if (index === 2) rankClass = 'third';

                return `
                    <div class="player-item">
                        <div class="player-rank ${rankClass}">${index + 1}</div>
                        <div class="player-info">
                            <div class="player-name">${player.name}</div>
                            <div class="player-score">${player.score} Punkte</div>
                        </div>
                        <input 
                            type="number" 
                            class="player-score-input" 
                            value="${player.score}"
                            onchange="updateScore(${originalIndex}, this.value)"
                            min="0"
                        >
                        <button class="delete-player-btn" onclick="deletePlayer(${originalIndex})">‚úï</button>
                    </div>
                `;
            }).join('');
        }

        // Enter-Taste zum Hinzuf√ºgen
        document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        function selectGame(gameNumber) {
            console.log(`Spiel ${gameNumber} wurde ausgew√§hlt`);
            
            if (gameNumber === 1) {
                openWerBinIch();
            } else if (gameNumber === 2) {
                openCantinaBand();
            } else if (gameNumber === 3) {
                openGezinkterPfeil();
            } else if (gameNumber === 4) {
                openHigherOrLower();
            } else if (gameNumber === 5) {
                openSchaetzenSpiel();
            } else if (gameNumber === 6) {
                openEinlochen();
            } else if (gameNumber === 7) {
                openAuktionshaus();
            } else if (gameNumber === 8) {
                openAuslandsmausJeans();
            } else if (gameNumber === 9) {
                openElFinale();
            } else {
                // F√ºr zuk√ºnftige Spiele: Zeige Spielregeln-Modal
                showGameRules(gameNumber);
            }
        }

        // Generische Spielregeln f√ºr noch nicht konfigurierte Spiele
        function showGameRules(gameNumber) {
            const modal = document.getElementById('gameModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalIcon = document.getElementById('modalIcon');
            const modalBody = document.getElementById('modalBody');
            
            const gameIcons = ['üòé', 'üéµ', 'üéØ', 'üé®', 'ü§î', 'ü•§', 'üéµ', 'üé§', 'üéß'];
            const gameTitles = ['Wer zum Teufel bin ich?', 'Cantina Band', 'Gezinkter Pfeil!', 'Spiel 4', 'Sch√§tzen, sch√§tzen und raten', 'Einlochen!', 'Spiel 7', 'Spiel 8', 'Spiel 9'];
            
            modalIcon.textContent = gameIcons[gameNumber - 1];
            modalTitle.textContent = gameTitles[gameNumber - 1];
            
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">${gameIcons[gameNumber - 1]}</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">${gameTitles[gameNumber - 1]}</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 40px; margin-bottom: 30px;">
                        <p style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.9);">
                            Dieses Spiel ist noch nicht konfiguriert.
                        </p>
                    </div>

                    <button class="save-config-btn" onclick="closeModal()" style="font-size: 1.1rem; padding: 16px 40px;">
                        ‚Üê Zur√ºck zur √úbersicht
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Wer bin ich - Spiel Variablen
        let uploadedImages = [];
        let currentRoundIndex = 0;
        let gameTimer = null;
        let timeRemaining = 30;
        let isPaused = false;
        let currentPixelation = 50;
        let lastUpdate = Date.now();
        let animationFrameId = null;
        let gamePlayers = []; // Spieler im aktuellen Spiel mit eigenen Punkten

        // ========================================
        // SPIEL 2: Cantina Band (Audio Quiz)
        // ========================================
        
        let uploadedAudioFiles = [];
        let cantinaBandPlayers = [];
        let currentAudioIndex = 0;
        let audioElement = null;
        let isAudioPlaying = false;
        let audioUpdateInterval = null;
        let showSongName = false; // Kontrolliert ob Song-Name sichtbar ist

        function openCantinaBand() {
            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'üéµ';
            modalTitle.textContent = 'Cantina Band';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;"><img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;"></div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">üéµ</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Cantina Band</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ Lieder-Raten mit verschiedenen Songs</li>
                            <li style="margin-bottom: 12px;">‚úÖ Songs, Serien-Intros oder Musik aus Computerspielen</li>
                            <li style="margin-bottom: 12px;">‚úÖ Benutzt den Buzzer, um zu antworten</li>
                            <li style="margin-bottom: 12px;">‚úÖ Wer die meisten Lieder err√§t, gewinnt</li>
                        </ul>
                        
                        <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%); border: 2px solid rgba(124, 58, 237, 0.5); border-radius: 12px;">
                            <p style="font-size: 1.2rem; font-weight: 700; color: #ffffff; line-height: 1.6; margin: 0;">
                                üí° Tipp: Nicht nur Songs, sondern auch Intros von Filmen, Serien und Videospielen verwenden!
                            </p>
                        </div>
                    </div>

                    <button class="save-config-btn" onclick="showCantinaBandUpload()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚úì Verstanden, weiter!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function showCantinaBandUpload() {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div class="config-section">
                    <h3>MP3-Dateien hochladen</h3>
                    <p>Lade deine Musik-Dateien hoch. Jeder Song wird eine Runde sein.</p>
                    
                    <div class="upload-area" id="audioUploadArea">
                        <input type="file" id="audioInput" accept="audio/mp3,audio/mpeg,audio/*" multiple style="display: none;">
                        <div class="upload-placeholder" onclick="document.getElementById('audioInput').click()">
                            <div style="font-size: 3rem; margin-bottom: 10px;">üéµ</div>
                            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 5px;">MP3-Dateien hochladen</div>
                            <div style="font-size: 0.9rem; opacity: 0.7;">Klicken oder Dateien hierher ziehen</div>
                            <div id="audioUploadCount" style="margin-top: 15px; font-size: 1.1rem; font-weight: 600; color: #7c3aed;">0 Songs hochgeladen</div>
                        </div>
                    </div>
                    
                    <button class="save-config-btn" onclick="startCantinaBand()" id="startAudioGameBtn" style="display: none;">
                        ‚ñ∂Ô∏è Spiel starten
                    </button>
                </div>
            `;

            setTimeout(() => {
                const audioInput = document.getElementById('audioInput');
                if (audioInput) {
                    audioInput.addEventListener('change', (e) => {
                        const files = e.target.files;
                        Array.from(files).forEach(file => {
                            if (file.type.startsWith('audio/')) {
                                const reader = new FileReader();
                                reader.onload = (e) => {
                                    uploadedAudioFiles.push({
                                        type: 'mp3',
                                        data: e.target.result,
                                        name: file.name.replace(/\.(mp3|mpeg|wav)$/i, '')
                                    });
                                    updateAudioUploadCount();
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    });
                }
            }, 100);
        }

        function updateAudioUploadCount() {
            const countEl = document.getElementById('audioUploadCount');
            if (countEl) {
                countEl.textContent = `${uploadedAudioFiles.length} ${uploadedAudioFiles.length === 1 ? 'Song' : 'Songs'} hochgeladen`;
            }
            const btnEl = document.getElementById('startAudioGameBtn');
            if (btnEl) {
                btnEl.style.display = uploadedAudioFiles.length > 0 ? 'block' : 'none';
            }
        }

        function startCantinaBand() {
            if (uploadedAudioFiles.length === 0) {
                alert('Bitte lade zuerst Audio-Dateien hoch!');
                return;
            }
            uploadedAudioFiles = uploadedAudioFiles.sort(() => Math.random() - 0.5);
            cantinaBandPlayers = players.map(p => ({ name: p.name, score: 0 }));
            currentAudioIndex = 0;
            showAudioGameView();
        }

        function showAudioGameView() {
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="display: flex; gap: 20px; height: 100%; min-height: 700px;">
                    <div style="width: 350px; display: flex; flex-direction: column; gap: 15px;">
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üìä Spielinfo</h3>
                            <div class="info-row">
                                <span class="info-label">Runde:</span>
                                <span class="info-value" id="currentAudioRound">1</span> / <span id="totalAudioRounds">${uploadedAudioFiles.length}</span>
                            </div>
                        </div>
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üéµ Steuerung</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="control-btn-full" onclick="playPauseAudio()" id="playPauseBtn">‚ñ∂Ô∏è Play</button>
                                <button class="control-btn-full" onclick="restartAudio()">‚èÆÔ∏è Von vorne</button>
                                <button class="control-btn-full" onclick="toggleSongName()" id="toggleNameBtn" style="background: rgba(124, 58, 237, 0.3); border-color: rgba(124, 58, 237, 0.5);">üëÅÔ∏è Name anzeigen</button>
                                <button class="control-btn-full" onclick="skipAudioRound()">‚è≠Ô∏è Song √ºberspringen</button>
                                <button class="control-btn-full danger" onclick="endCantinaBand()">üèÅ Spiel beenden</button>
                            </div>
                        </div>
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üë• Spieler</h3>
                            <div id="audioPlayersList" style="max-height: 300px; overflow-y: auto;"></div>
                        </div>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; position: relative;">
                        <div class="audio-player-container">
                            <div class="song-title-display" id="songTitle" style="display: none; opacity: 0; transition: opacity 0.3s;">Song-Name versteckt</div>
                            <div class="audio-visualizer" id="audioVisualizer">üéµ</div>
                            <div class="audio-timeline">
                                <div class="audio-progress-bar" onclick="seekAudio(event)">
                                    <div class="audio-progress-fill" id="audioProgressFill" style="width: 0%"></div>
                                </div>
                                <div class="audio-time-display">
                                    <span id="currentTime">0:00</span>
                                    <span id="totalTime">0:00</span>
                                </div>
                            </div>
                            <div class="audio-controls">
                                <button class="audio-btn" onclick="restartAudio()">‚èÆÔ∏è</button>
                                <button class="audio-btn primary" onclick="playPauseAudio()" id="mainPlayBtn">‚ñ∂Ô∏è</button>
                                <button class="audio-btn" onclick="skipAudioRound()">‚è≠Ô∏è</button>
                            </div>
                            <button class="next-round-btn" onclick="showAudioWinnerSelection()" style="margin-top: 20px;">Rundengewinner ausw√§hlen</button>
                        </div>
                        <div class="winner-selection-overlay" id="audioWinnerOverlay">
                            <div class="winner-title">üèÜ Wer hat diese Runde gewonnen?</div>
                            <div class="winner-players" id="audioWinnerList"></div>
                            <button class="no-winner-btn" onclick="selectAudioWinner(null)">Niemand hat gewonnen</button>
                        </div>
                        <div class="winner-selection-overlay" id="audioFinalResultsOverlay">
                            <div class="final-results">
                                <h3>üéâ Spielende - Ergebnisse</h3>
                                <div id="audioFinalResultsList"></div>
                            </div>
                            <button class="next-round-btn" onclick="closeModal()" style="margin-top: 20px;">Zur√ºck zur √úbersicht</button>
                        </div>
                    </div>
                </div>
            `;
            
            updateAudioPlayersList();
            loadAudioTrack();
        }

        function loadAudioTrack() {
            if (currentAudioIndex >= uploadedAudioFiles.length) {
                showAudioFinalResults();
                return;
            }
            
            const track = uploadedAudioFiles[currentAudioIndex];
            
            // Cleanup alter Medien
            if (audioElement) {
                audioElement.pause();
                audioElement = null;
            }
            if (audioUpdateInterval) {
                clearInterval(audioUpdateInterval);
                audioUpdateInterval = null;
            }
            
            // Reset Song-Name-Anzeige
            showSongName = false;
            const songTitleEl = document.getElementById('songTitle');
            songTitleEl.textContent = track.name;
            songTitleEl.style.display = 'none';
            songTitleEl.style.opacity = '0';
            
            const toggleBtn = document.getElementById('toggleNameBtn');
            if (toggleBtn) toggleBtn.textContent = 'üëÅÔ∏è Name anzeigen';
            
            document.getElementById('currentAudioRound').textContent = currentAudioIndex + 1;
            document.getElementById('currentTime').textContent = '0:00';
            document.getElementById('audioProgressFill').style.width = '0%';
            isAudioPlaying = false;
            document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Play';
            document.getElementById('mainPlayBtn').textContent = '‚ñ∂Ô∏è';
            
            // MP3 laden
            audioElement = new Audio(track.data);
            audioElement.addEventListener('loadedmetadata', () => {
                document.getElementById('totalTime').textContent = formatTime(audioElement.duration);
            });
            audioElement.addEventListener('timeupdate', () => {
                if (!audioElement) return;
                const percentage = (audioElement.currentTime / audioElement.duration) * 100;
                document.getElementById('audioProgressFill').style.width = percentage + '%';
                document.getElementById('currentTime').textContent = formatTime(audioElement.currentTime);
            });
            audioElement.addEventListener('ended', () => {
                isAudioPlaying = false;
                document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Play';
                document.getElementById('mainPlayBtn').textContent = '‚ñ∂Ô∏è';
                document.getElementById('audioVisualizer').classList.remove('playing');
            });
        }

        function playPauseAudio() {
            if (!audioElement) return;
            
            if (isAudioPlaying) {
                audioElement.pause();
                document.getElementById('audioVisualizer').classList.remove('playing');
                document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Play';
                document.getElementById('mainPlayBtn').textContent = '‚ñ∂Ô∏è';
            } else {
                audioElement.play();
                document.getElementById('audioVisualizer').classList.add('playing');
                document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è Pause';
                document.getElementById('mainPlayBtn').textContent = '‚è∏Ô∏è';
            }
            isAudioPlaying = !isAudioPlaying;
        }

        function restartAudio() {
            if (!audioElement) return;
            audioElement.currentTime = 0;
            if (isAudioPlaying) audioElement.play();
        }

        function skipAudioRound() {
            if (confirm('M√∂chtest du diesen Song wirklich √ºberspringen?')) {
                if (audioElement) audioElement.pause();
                if (audioUpdateInterval) {
                    clearInterval(audioUpdateInterval);
                    audioUpdateInterval = null;
                }
                currentAudioIndex++;
                loadAudioTrack();
            }
        }

        function seekAudio(event) {
            if (!audioElement) return;
            const progressBar = event.currentTarget;
            const clickX = event.offsetX;
            const width = progressBar.offsetWidth;
            audioElement.currentTime = audioElement.duration * (clickX / width);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function toggleSongName() {
            showSongName = !showSongName;
            const songTitleEl = document.getElementById('songTitle');
            const toggleBtn = document.getElementById('toggleNameBtn');
            
            if (showSongName) {
                // Name anzeigen
                songTitleEl.style.display = 'block';
                setTimeout(() => {
                    songTitleEl.style.opacity = '1';
                }, 10);
                toggleBtn.textContent = 'üôà Name verstecken';
            } else {
                // Name verstecken
                songTitleEl.style.opacity = '0';
                setTimeout(() => {
                    songTitleEl.style.display = 'none';
                }, 300);
                toggleBtn.textContent = 'üëÅÔ∏è Name anzeigen';
            }
        }

        function updateAudioPlayersList() {
            const container = document.getElementById('audioPlayersList');
            if (!container) return;
            const sorted = [...cantinaBandPlayers].sort((a, b) => b.score - a.score);
            container.innerHTML = sorted.map((player, index) => {
                const isTop3 = index < 3;
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                return `
                    <div class="game-player-item" style="${isTop3 ? 'background: rgba(124, 58, 237, 0.2); border-color: rgba(124, 58, 237, 0.4);' : ''}">
                        <span class="game-player-name">${isTop3 ? medals[index] + ' ' : ''}${player.name}</span>
                        <span class="game-player-score">${player.score}</span>
                    </div>
                `;
            }).join('');
        }

        function showAudioWinnerSelection() {
            if (audioElement) {
                audioElement.pause();
                isAudioPlaying = false;
            }
            const container = document.getElementById('audioWinnerList');
            container.innerHTML = cantinaBandPlayers.map((player, index) => `
                <button class="winner-player-btn" onclick="selectAudioWinner(${index})">${player.name}</button>
            `).join('');
            document.getElementById('audioWinnerOverlay').classList.add('active');
        }

        function selectAudioWinner(playerIndex) {
            if (playerIndex !== null) {
                cantinaBandPlayers[playerIndex].score += 1;
                updateAudioPlayersList();
            }
            document.getElementById('audioWinnerOverlay').classList.remove('active');
            currentAudioIndex++;
            if (currentAudioIndex >= uploadedAudioFiles.length) {
                showAudioFinalResults();
            } else {
                loadAudioTrack();
            }
        }

        function showAudioFinalResults() {
            if (audioElement) audioElement.pause();
            if (audioUpdateInterval) {
                clearInterval(audioUpdateInterval);
                audioUpdateInterval = null;
            }
            const container = document.getElementById('audioFinalResultsList');
            const sorted = [...cantinaBandPlayers].sort((a, b) => b.score - a.score);
            const maxScore = sorted[0]?.score || 0;
            container.innerHTML = sorted.map((player, index) => {
                const isWinner = player.score === maxScore && maxScore > 0;
                const rank = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                return `
                    <div class="final-player-item ${isWinner ? 'winner' : ''}">
                        <span class="final-player-rank">${rank}</span>
                        <span class="final-player-name">${player.name}</span>
                        <span class="final-player-score">${player.score} Punkte</span>
                    </div>
                `;
            }).join('');
            document.getElementById('audioFinalResultsOverlay').classList.add('active');
        }

        function endCantinaBand() {
            if (confirm('M√∂chtest du das Spiel wirklich beenden?')) {
                showAudioFinalResults();
            }
        }

        // Modal √∂ffnen f√ºr "Wer zum Teufel bin ich?"
        function openWerBinIch() {
            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            
            // Setze Icon und Titel
            modalIcon.textContent = 'üòé';
            modalTitle.textContent = 'Wer zum Teufel bin ich?';
            
            // Pr√ºfe ob die Views existieren, wenn nicht, erstelle sie neu
            if (!document.getElementById('rulesView')) {
                // Modal Body wurde von anderem Spiel √ºberschrieben, erstelle Views neu
                const modalBody = document.getElementById('modalBody');
                modalBody.innerHTML = getWerBinIchHTML();
                setupWerBinIchEventListeners();
            }
            
            // Zeige Rules View
            document.getElementById('rulesView').style.display = 'block';
            document.getElementById('uploadView').style.display = 'none';
            document.getElementById('startView').style.display = 'none';
            document.getElementById('gameView').style.display = 'none';
            modal.classList.add('active');
            
            // Reset
            uploadedImages = [];
            if (document.getElementById('uploadCount')) {
                document.getElementById('uploadCount').textContent = '0 Bilder hochgeladen';
            }
            if (document.getElementById('startGameBtn')) {
                document.getElementById('startGameBtn').style.display = 'none';
            }
        }

        // HTML f√ºr "Wer zum Teufel bin ich?" generieren
        function getWerBinIchHTML() {
            return `
                <!-- Spielregeln-Ansicht -->
                <div id="rulesView" style="display: block;">
                    <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                        <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;"><img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;"></div>
                        
                        <div style="font-size: 4rem; margin-bottom: 20px;">üòé</div>
                        <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Wer zum Teufel bin ich?</h2>
                        
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                            <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                            <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                                <li style="margin-bottom: 12px;">‚úÖ Ein verpixeltes Bild wird angezeigt - welcher Promi ist es?</li>
                                <li style="margin-bottom: 12px;">‚úÖ Innerhalb von 30 Sekunden wird das Bild immer klarer</li>
                                <li style="margin-bottom: 12px;">‚úÖ Wer die Antwort wei√ü, dr√ºckt den Buzzer - der Timer wird gestoppt</li>
                                <li style="margin-bottom: 12px;">‚úÖ Bei falscher Antwort scheidet der Spieler aus - die Runde geht f√ºr alle anderen weiter</li>
                            </ul>
                        </div>

                        <button class="save-config-btn" onclick="acceptRules()" style="font-size: 1.2rem; padding: 18px 50px;">
                            ‚úì Verstanden, weiter!
                        </button>
                    </div>
                </div>

                <!-- Upload-Ansicht -->
                <div id="uploadView" style="display: none;">
                    <div class="config-section">
                        <h3>Bilder hochladen</h3>
                        <p>Lade bis zu 10 Bilder hoch. Jedes Bild wird eine Runde sein.</p>
                        
                        <div class="upload-area" id="uploadArea">
                            <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-placeholder" onclick="document.getElementById('imageInput').click()">
                                <div style="font-size: 3rem; margin-bottom: 10px;">üìÅ</div>
                                <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 5px;">Bilder hochladen</div>
                                <div style="font-size: 0.9rem; opacity: 0.7;">Klicken oder Bilder hierher ziehen (max. 10)</div>
                                <div id="uploadCount" style="margin-top: 15px; font-size: 1.1rem; font-weight: 600; color: #7c3aed;">0 Bilder hochgeladen</div>
                            </div>
                        </div>
                        
                        <button class="save-config-btn" onclick="showGameStart()" id="startGameBtn" style="display: none;">
                            ‚ñ∂Ô∏è Weiter zum Spiel
                        </button>
                    </div>
                </div>

                <!-- Start-Ansicht -->
                <div id="startView" style="display: none;">
                    <div class="config-section" style="text-align: center; padding: 80px 40px;">
                        <h3 style="font-size: 2.5rem; margin-bottom: 20px;">Bereit zum Spielen?</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">
                            <span id="totalImages">0</span> Bilder wurden hochgeladen
                        </p>
                        <p style="font-size: 1rem; opacity: 0.7; margin-bottom: 40px;">
                            Jede Runde dauert 30 Sekunden
                        </p>
                        <button class="save-config-btn" onclick="startGame()" style="font-size: 1.3rem; padding: 20px 50px;">
                            üéÆ Spiel starten!
                        </button>
                    </div>
                </div>

                <!-- Spiel-Ansicht -->
                <div id="gameView" style="display: none;">
                    <div style="display: flex; gap: 20px; height: 100%;">
                        <div style="width: 350px; display: flex; flex-direction: column; gap: 15px;">
                            <div class="info-card">
                                <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üìä Spielinfo</h3>
                                <div class="info-row">
                                    <span class="info-label">Aktuelle Runde:</span>
                                    <span class="info-value" id="currentRound">1</span> / <span id="totalRounds">0</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Verbleibende Zeit:</span>
                                    <span class="info-value timer-value" id="timer">30</span>s
                                </div>
                            </div>

                            <div class="info-card">
                                <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üéÆ Steuerung</h3>
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <button class="control-btn-full" onclick="pauseGame()" id="pauseBtn">‚è∏Ô∏è Pause</button>
                                    <button class="control-btn-full" onclick="skipRound()">‚è≠Ô∏è Runde √ºberspringen</button>
                                    <button class="control-btn-full" onclick="resetRound()">üîÑ Runde neu starten</button>
                                    <button class="control-btn-full danger" onclick="endGame()">üèÅ Spiel beenden</button>
                                </div>
                            </div>

                            <div class="info-card">
                                <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üë• Spieler</h3>
                                <div id="gamePlayersList" style="max-height: 300px; overflow-y: auto;">
                                    <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
                                        Keine Spieler ausgew√§hlt
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="flex: 1; display: flex; flex-direction: column; position: relative;">
                            <div class="image-display-large">
                                <canvas id="gameCanvas"></canvas>
                                
                                <div class="round-complete-overlay" id="roundCompleteOverlay">
                                    <div class="round-complete-message">‚è±Ô∏è Zeit abgelaufen!</div>
                                    <button class="next-round-btn" onclick="showWinnerSelection()">Gewinner ausw√§hlen ‚ñ∂Ô∏è</button>
                                </div>

                                <div class="winner-selection-overlay" id="winnerSelectionOverlay">
                                    <div class="winner-title">üèÜ Wer hat diese Runde gewonnen?</div>
                                    <div class="winner-players" id="winnerPlayersList"></div>
                                    <button class="no-winner-btn" onclick="selectWinner(null)">Niemand hat gewonnen</button>
                                </div>

                                <div class="winner-selection-overlay" id="finalResultsOverlay">
                                    <div class="final-results">
                                        <h3>üéâ Spielende - Ergebnisse</h3>
                                        <div id="finalResultsList"></div>
                                    </div>
                                    <button class="next-round-btn" onclick="closeModal()" style="margin-top: 20px;">Zur√ºck zur √úbersicht</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event Listener f√ºr "Wer zum Teufel bin ich?" einrichten
        function setupWerBinIchEventListeners() {
            setTimeout(() => {
                const imageInput = document.getElementById('imageInput');
                const uploadArea = document.getElementById('uploadArea');
                
                if (imageInput) {
                    imageInput.addEventListener('change', handleImageUpload);
                }
                
                if (uploadArea) {
                    uploadArea.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        uploadArea.querySelector('.upload-placeholder').style.borderColor = '#7c3aed';
                    });

                    uploadArea.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        uploadArea.querySelector('.upload-placeholder').style.borderColor = 'rgba(255, 255, 255, 0.2)';
                    });

                    uploadArea.addEventListener('drop', (e) => {
                        e.preventDefault();
                        uploadArea.querySelector('.upload-placeholder').style.borderColor = 'rgba(255, 255, 255, 0.2)';
                        const files = e.dataTransfer.files;
                        handleFiles(files);
                    });
                }
            }, 100);
        }

        // Spielregeln akzeptieren und zum Upload gehen
        function acceptRules() {
            document.getElementById('rulesView').style.display = 'none';
            document.getElementById('uploadView').style.display = 'block';
        }

        // Bild-Upload Handler
        document.addEventListener('DOMContentLoaded', function() {
            const imageInput = document.getElementById('imageInput');
            const uploadArea = document.getElementById('uploadArea');

            imageInput.addEventListener('change', handleImageUpload);

            // Drag & Drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.querySelector('.upload-placeholder').style.borderColor = '#7c3aed';
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.querySelector('.upload-placeholder').style.borderColor = 'rgba(255, 255, 255, 0.2)';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.querySelector('.upload-placeholder').style.borderColor = 'rgba(255, 255, 255, 0.2)';
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
        });

        function handleImageUpload(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (uploadedImages.length + files.length > 10) {
                alert('Du kannst maximal 10 Bilder hochladen!');
                return;
            }

            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImages.push(e.target.result);
                        updateUploadCount();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function updateUploadCount() {
            document.getElementById('uploadCount').textContent = 
                `${uploadedImages.length} ${uploadedImages.length === 1 ? 'Bild' : 'Bilder'} hochgeladen`;
            
            document.getElementById('startGameBtn').style.display = 
                uploadedImages.length > 0 ? 'block' : 'none';
        }

        function showGameStart() {
            if (uploadedImages.length === 0) {
                alert('Bitte lade zuerst Bilder hoch!');
                return;
            }

            document.getElementById('uploadView').style.display = 'none';
            document.getElementById('startView').style.display = 'block';
            document.getElementById('totalImages').textContent = uploadedImages.length;
        }

        // Spiel starten
        function startGame() {
            if (uploadedImages.length === 0) {
                alert('Bitte lade zuerst Bilder hoch!');
                return;
            }

            // Kopiere Spieler aus der Hauptliste mit eigenen Punkten
            gamePlayers = players.map(p => ({
                name: p.name,
                gameScore: 0
            }));

            currentRoundIndex = 0;
            document.getElementById('uploadView').style.display = 'none';
            document.getElementById('startView').style.display = 'none';
            document.getElementById('gameView').style.display = 'block';
            document.getElementById('totalRounds').textContent = uploadedImages.length;
            
            updateGamePlayersList();
            startRound();
        }

        // Spielerliste im Spiel aktualisieren
        function updateGamePlayersList() {
            const container = document.getElementById('gamePlayersList');
            
            if (gamePlayers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
                        Keine Spieler ausgew√§hlt
                    </div>
                `;
                return;
            }

            // Sortiere nach Punkten
            const sorted = [...gamePlayers].sort((a, b) => b.gameScore - a.gameScore);

            container.innerHTML = sorted.map(player => `
                <div class="game-player-item">
                    <span class="game-player-name">${player.name}</span>
                    <span class="game-player-score">${player.gameScore}</span>
                </div>
            `).join('');
        }

        // Runde starten
        function startRound() {
            if (currentRoundIndex >= uploadedImages.length) {
                endGame();
                return;
            }

            // Verstecke Overlay
            document.getElementById('roundCompleteOverlay').classList.remove('active');

            timeRemaining = 30;
            currentPixelation = 50;
            isPaused = false;
            lastUpdate = Date.now();
            
            document.getElementById('currentRound').textContent = currentRoundIndex + 1;
            document.getElementById('timer').textContent = timeRemaining;
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';

            // Canvas Setup
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = () => {
                // Starte Animation Loop
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                animateRound(ctx, img);
            };
            
            img.src = uploadedImages[currentRoundIndex];
        }

        // Animation Loop
        function animateRound(ctx, img) {
            if (isPaused) {
                animationFrameId = requestAnimationFrame(() => animateRound(ctx, img));
                return;
            }

            const now = Date.now();
            const delta = (now - lastUpdate) / 1000;
            lastUpdate = now;

            // Update Timer
            timeRemaining -= delta;
            if (timeRemaining < 0) timeRemaining = 0;
            document.getElementById('timer').textContent = Math.ceil(timeRemaining);

            // Berechne Pixelation (50 bei Start, 1 bei Ende)
            const progress = Math.min(1, (30 - timeRemaining) / 30);
            currentPixelation = Math.max(1, Math.round(50 - (progress * 49)));

            // Zeichne Bild mit aktuellem Pixelation
            drawPixelatedImage(ctx, img, currentPixelation);

            // Pr√ºfe ob Runde vorbei ist
            if (timeRemaining <= 0) {
                // Zeige Overlay und warte auf Benutzer-Eingabe
                document.getElementById('roundCompleteOverlay').classList.add('active');
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
            } else {
                animationFrameId = requestAnimationFrame(() => animateRound(ctx, img));
            }
        }

        // N√§chste Runde manuell starten
        function nextRound() {
            document.getElementById('roundCompleteOverlay').classList.remove('active');
            currentRoundIndex++;
            startRound();
        }

        // Gewinner-Auswahl anzeigen
        function showWinnerSelection() {
            document.getElementById('roundCompleteOverlay').classList.remove('active');
            
            if (gamePlayers.length === 0) {
                // Keine Spieler, gehe direkt zur n√§chsten Runde
                nextRound();
                return;
            }

            const container = document.getElementById('winnerPlayersList');
            container.innerHTML = gamePlayers.map((player, index) => `
                <button class="winner-player-btn" onclick="selectWinner(${index})">
                    ${player.name}
                </button>
            `).join('');

            document.getElementById('winnerSelectionOverlay').classList.add('active');
        }

        // Gewinner ausw√§hlen
        function selectWinner(playerIndex) {
            if (playerIndex !== null) {
                gamePlayers[playerIndex].gameScore += 1;
                updateGamePlayersList();
            }

            document.getElementById('winnerSelectionOverlay').classList.remove('active');
            
            // Pr√ºfe ob weitere Runden kommen
            currentRoundIndex++;
            if (currentRoundIndex >= uploadedImages.length) {
                showFinalResults();
            } else {
                startRound();
            }
        }

        // Endergebnis anzeigen
        function showFinalResults() {
            const container = document.getElementById('finalResultsList');
            
            // Sortiere Spieler nach Punkten
            const sorted = [...gamePlayers].sort((a, b) => b.gameScore - a.gameScore);
            const maxScore = sorted[0]?.gameScore || 0;

            container.innerHTML = sorted.map((player, index) => {
                const isWinner = player.gameScore === maxScore && maxScore > 0;
                const rank = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                
                return `
                    <div class="final-player-item ${isWinner ? 'winner' : ''}">
                        <span class="final-player-rank">${rank}</span>
                        <span class="final-player-name">${player.name}</span>
                        <span class="final-player-score">${player.gameScore} Punkte</span>
                    </div>
                `;
            }).join('');

            document.getElementById('finalResultsOverlay').classList.add('active');
        }

        // Pause/Resume
        function pauseGame() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = 
                isPaused ? '‚ñ∂Ô∏è Fortsetzen' : '‚è∏Ô∏è Pause';
            if (!isPaused) {
                lastUpdate = Date.now();
            }
        }

        // Bild mit Pixelation zeichnen
        function drawPixelatedImage(ctx, img, pixelSize) {
            pixelSize = Math.max(1, pixelSize);
            
            const canvas = ctx.canvas;
            
            // Feste Canvas-Gr√∂√üe: 1200x800
            const targetWidth = 1200;
            const targetHeight = 800;
            
            canvas.width = targetWidth;
            canvas.height = targetHeight;
            
            // Berechne Skalierung um Bild in 1200x800 zu fitten (mit Letterboxing)
            const scale = Math.min(targetWidth / img.width, targetHeight / img.height);
            const scaledWidth = img.width * scale;
            const scaledHeight = img.height * scale;
            
            // Zentriere das Bild
            const offsetX = (targetWidth - scaledWidth) / 2;
            const offsetY = (targetHeight - scaledHeight) / 2;
            
            // Erstelle tempor√§res Canvas f√ºr Pixelation
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            const pixelScaledWidth = Math.max(1, Math.ceil(scaledWidth / pixelSize));
            const pixelScaledHeight = Math.max(1, Math.ceil(scaledHeight / pixelSize));
            
            tempCanvas.width = pixelScaledWidth;
            tempCanvas.height = pixelScaledHeight;
            
            // Deaktiviere Smoothing f√ºr Pixel-Effekt
            tempCtx.imageSmoothingEnabled = false;
            ctx.imageSmoothingEnabled = false;
            
            // Zeichne Bild klein auf temp Canvas
            tempCtx.drawImage(img, 0, 0, pixelScaledWidth, pixelScaledHeight);
            
            // L√∂sche Canvas und setze schwarzen Hintergrund
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, targetWidth, targetHeight);
            
            // Skaliere zur√ºck auf Zielgr√∂√üe f√ºr Pixel-Effekt (mittig)
            ctx.drawImage(tempCanvas, 0, 0, pixelScaledWidth, pixelScaledHeight, 
                         offsetX, offsetY, scaledWidth, scaledHeight);
        }

        // Runde √ºberspringen
        function skipRound() {
            if (confirm('M√∂chtest du diese Runde wirklich √ºberspringen?')) {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                currentRoundIndex++;
                startRound();
            }
        }

        // Runde neu starten
        function resetRound() {
            if (confirm('M√∂chtest du diese Runde neu starten?')) {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                startRound();
            }
        }

        // Spiel beenden
        function endGame() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            
            if (confirm('M√∂chtest du das Spiel wirklich beenden?')) {
                showFinalResults();
            } else {
                // Fortsetzen
                lastUpdate = Date.now();
                if (!isPaused && timeRemaining > 0) {
                    const canvas = document.getElementById('gameCanvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    img.onload = () => {
                        animateRound(ctx, img);
                    };
                    img.src = uploadedImages[currentRoundIndex];
                }
            }
        }

        // ========================================
        // SPIEL 3: Gezinkter Pfeil! (Turnier)
        // ========================================
        
        let tournamentBracket = [];
        let tournamentRoundIndex = 0;

        function openGezinkterPfeil() {
            if (players.length < 2) {
                alert('Du brauchst mindestens 2 Spieler f√ºr ein Turnier!');
                return;
            }

            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'üéØ';
            modalTitle.textContent = 'Gezinkter Pfeil!';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; font-size: 3rem; opacity: 0.3;">üö¨</div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">üéØ</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Gezinkter Pfeil!</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ K.O.-Turnier - Jeder gegen Jeden</li>
                            <li style="margin-bottom: 12px;">‚úÖ Immer zwei Spieler treten gegeneinander an</li>
                            <li style="margin-bottom: 12px;">‚úÖ Best of 1 - Ein Spiel entscheidet</li>
                        </ul>
                    </div>

                    <button class="save-config-btn" onclick="startTournament()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚úì Turnier starten!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function startTournament() {
            // Spieler zuf√§llig mischen
            const shuffledPlayers = [...players].sort(() => Math.random() - 0.5);
            
            // Erstelle erste Runde
            tournamentBracket = [];
            tournamentRoundIndex = 0;
            
            const firstRound = [];
            for (let i = 0; i < shuffledPlayers.length; i += 2) {
                if (i + 1 < shuffledPlayers.length) {
                    firstRound.push({
                        player1: shuffledPlayers[i].name,
                        player2: shuffledPlayers[i + 1].name,
                        winner: null
                    });
                } else {
                    // Ungerader Spieler bekommt Freilos
                    firstRound.push({
                        player1: shuffledPlayers[i].name,
                        player2: null,
                        winner: shuffledPlayers[i].name
                    });
                }
            }
            
            tournamentBracket.push(firstRound);
            displayTournament();
        }

        function displayTournament() {
            const modalBody = document.getElementById('modalBody');
            
            // Pr√ºfe ob Turnier beendet ist
            const lastRound = tournamentBracket[tournamentBracket.length - 1];
            const isTournamentComplete = lastRound.length === 1 && lastRound[0].winner;
            
            if (isTournamentComplete) {
                // Zeige Champion
                modalBody.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 600px;">
                        <div class="tournament-champion">
                            <div class="champion-trophy">üèÜ</div>
                            <div class="champion-name">${lastRound[0].winner}</div>
                            <div class="champion-subtitle">Turniersieger!</div>
                            <button class="next-round-btn" onclick="closeModal()" style="margin-top: 30px;">
                                Zur√ºck zur √úbersicht
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="tournament-container">';
            
            // Zeige alle Runden horizontal
            tournamentBracket.forEach((round, roundIndex) => {
                const totalMatches = round.length;
                let roundName;
                
                if (totalMatches === 1) roundName = 'Finale';
                else if (totalMatches === 2) roundName = 'Halbfinale';
                else if (totalMatches === 4) roundName = 'Viertelfinale';
                else if (totalMatches === 8) roundName = 'Achtelfinale';
                else roundName = `Runde ${roundIndex + 1}`;
                
                html += `
                    <div class="tournament-round">
                        <div class="tournament-round-title">${roundName}</div>
                        <div class="tournament-matches">
                `;
                
                round.forEach((match, matchIndex) => {
                    if (match.player2 === null) {
                        // Freilos
                        html += `
                            <div class="tournament-match">
                                <div class="match-player winner">
                                    <span class="match-player-name">${match.player1}</span>
                                    <span class="match-player-status">üéüÔ∏è</span>
                                </div>
                            </div>
                        `;
                    } else {
                        const p1Escaped = match.player1.replace(/'/g, "\\'");
                        const p2Escaped = match.player2.replace(/'/g, "\\'");
                        
                        html += `
                            <div class="tournament-match">
                                <div class="match-player ${match.winner === match.player1 ? 'winner' : ''} ${match.winner && match.winner !== match.player1 ? 'eliminated' : ''}" 
                                     ${match.winner ? '' : `onclick="selectMatchWinner(${roundIndex}, ${matchIndex}, '${p1Escaped}')"`}>
                                    <span class="match-player-name">${match.player1}</span>
                                    <span class="match-player-status">${match.winner === match.player1 ? 'üèÜ' : ''}</span>
                                </div>
                                <div class="match-vs">VS</div>
                                <div class="match-player ${match.winner === match.player2 ? 'winner' : ''} ${match.winner && match.winner !== match.player2 ? 'eliminated' : ''}"
                                     ${match.winner ? '' : `onclick="selectMatchWinner(${roundIndex}, ${matchIndex}, '${p2Escaped}')"`}>
                                    <span class="match-player-name">${match.player2}</span>
                                    <span class="match-player-status">${match.winner === match.player2 ? 'üèÜ' : ''}</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            modalBody.innerHTML = html;
        }

        function selectMatchWinner(roundIndex, matchIndex, winner) {
            const match = tournamentBracket[roundIndex][matchIndex];
            
            if (match.winner) return; // Match bereits entschieden
            
            match.winner = winner;
            
            // Pr√ºfe ob Runde abgeschlossen
            const currentRound = tournamentBracket[roundIndex];
            const allMatchesDecided = currentRound.every(m => m.winner !== null);
            
            if (allMatchesDecided && currentRound.length > 1) {
                // Erstelle n√§chste Runde
                const nextRound = [];
                for (let i = 0; i < currentRound.length; i += 2) {
                    if (i + 1 < currentRound.length) {
                        nextRound.push({
                            player1: currentRound[i].winner,
                            player2: currentRound[i + 1].winner,
                            winner: null
                        });
                    } else {
                        // Ungerader Gewinner bekommt Freilos
                        nextRound.push({
                            player1: currentRound[i].winner,
                            player2: null,
                            winner: currentRound[i].winner
                        });
                    }
                }
                tournamentBracket.push(nextRound);
            }
            
            displayTournament();
        }

        // ========================================
        // SPIEL 6: Einlochen! (Turnier)
        // ========================================
        
        let einlochenBracket = [];
        let einlochenRoundIndex = 0;

        function openEinlochen() {
            if (players.length < 2) {
                alert('Du brauchst mindestens 2 Spieler f√ºr ein Turnier!');
                return;
            }

            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'ü•§';
            modalTitle.textContent = 'Einlochen!';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; font-size: 3rem; opacity: 0.3;">üö¨</div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">ü•§</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Einlochen!</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ K.O.-Turnier - Jeder gegen Jeden</li>
                            <li style="margin-bottom: 12px;">‚úÖ Immer zwei Spieler treten gegeneinander an</li>
                            <li style="margin-bottom: 12px;">‚úÖ Best of 1 - Ein Spiel entscheidet</li>
                        </ul>
                    </div>

                    <button class="save-config-btn" onclick="startEinlochenTournament()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚úì Turnier starten!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function startEinlochenTournament() {
            // Spieler zuf√§llig mischen
            const shuffledPlayers = [...players].sort(() => Math.random() - 0.5);
            
            // Erstelle erste Runde
            einlochenBracket = [];
            einlochenRoundIndex = 0;
            
            const firstRound = [];
            for (let i = 0; i < shuffledPlayers.length; i += 2) {
                if (i + 1 < shuffledPlayers.length) {
                    firstRound.push({
                        player1: shuffledPlayers[i].name,
                        player2: shuffledPlayers[i + 1].name,
                        winner: null
                    });
                } else {
                    // Ungerader Spieler bekommt Freilos
                    firstRound.push({
                        player1: shuffledPlayers[i].name,
                        player2: null,
                        winner: shuffledPlayers[i].name
                    });
                }
            }
            
            einlochenBracket.push(firstRound);
            displayEinlochenTournament();
        }

        function displayEinlochenTournament() {
            const modalBody = document.getElementById('modalBody');
            
            // Pr√ºfe ob Turnier beendet ist
            const lastRound = einlochenBracket[einlochenBracket.length - 1];
            const isTournamentComplete = lastRound.length === 1 && lastRound[0].winner;
            
            if (isTournamentComplete) {
                // Zeige Champion
                modalBody.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 600px;">
                        <div class="tournament-champion">
                            <div class="champion-trophy">üèÜ</div>
                            <div class="champion-name">${lastRound[0].winner}</div>
                            <div class="champion-subtitle">Turniersieger!</div>
                            <button class="next-round-btn" onclick="closeModal()" style="margin-top: 30px;">
                                Zur√ºck zur √úbersicht
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="tournament-container">';
            
            // Zeige alle Runden horizontal
            einlochenBracket.forEach((round, roundIndex) => {
                const totalMatches = round.length;
                let roundName;
                
                if (totalMatches === 1) roundName = 'Finale';
                else if (totalMatches === 2) roundName = 'Halbfinale';
                else if (totalMatches === 4) roundName = 'Viertelfinale';
                else if (totalMatches === 8) roundName = 'Achtelfinale';
                else roundName = `Runde ${roundIndex + 1}`;
                
                html += `
                    <div class="tournament-round">
                        <div class="tournament-round-title">${roundName}</div>
                        <div class="tournament-matches">
                `;
                
                round.forEach((match, matchIndex) => {
                    if (match.player2 === null) {
                        // Freilos
                        html += `
                            <div class="tournament-match">
                                <div class="match-player winner">
                                    <span class="match-player-name">${match.player1}</span>
                                    <span class="match-player-status">üéüÔ∏è</span>
                                </div>
                            </div>
                        `;
                    } else {
                        const p1Escaped = match.player1.replace(/'/g, "\\'");
                        const p2Escaped = match.player2.replace(/'/g, "\\'");
                        
                        html += `
                            <div class="tournament-match">
                                <div class="match-player ${match.winner === match.player1 ? 'winner' : ''} ${match.winner && match.winner !== match.player1 ? 'eliminated' : ''}" 
                                     ${match.winner ? '' : `onclick="selectEinlochenMatchWinner(${roundIndex}, ${matchIndex}, '${p1Escaped}')"`}>
                                    <span class="match-player-name">${match.player1}</span>
                                    <span class="match-player-status">${match.winner === match.player1 ? 'üèÜ' : ''}</span>
                                </div>
                                <div class="match-vs">VS</div>
                                <div class="match-player ${match.winner === match.player2 ? 'winner' : ''} ${match.winner && match.winner !== match.player2 ? 'eliminated' : ''}"
                                     ${match.winner ? '' : `onclick="selectEinlochenMatchWinner(${roundIndex}, ${matchIndex}, '${p2Escaped}')"`}>
                                    <span class="match-player-name">${match.player2}</span>
                                    <span class="match-player-status">${match.winner === match.player2 ? 'üèÜ' : ''}</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            modalBody.innerHTML = html;
        }

        function selectEinlochenMatchWinner(roundIndex, matchIndex, winner) {
            const match = einlochenBracket[roundIndex][matchIndex];
            
            if (match.winner) return; // Match bereits entschieden
            
            match.winner = winner;
            
            // Pr√ºfe ob Runde abgeschlossen
            const currentRound = einlochenBracket[roundIndex];
            const allMatchesDecided = currentRound.every(m => m.winner !== null);
            
            if (allMatchesDecided && currentRound.length > 1) {
                // Erstelle n√§chste Runde
                const nextRound = [];
                for (let i = 0; i < currentRound.length; i += 2) {
                    if (i + 1 < currentRound.length) {
                        nextRound.push({
                            player1: currentRound[i].winner,
                            player2: currentRound[i + 1].winner,
                            winner: null
                        });
                    } else {
                        // Ungerader Gewinner bekommt Freilos
                        nextRound.push({
                            player1: currentRound[i].winner,
                            player2: null,
                            winner: currentRound[i].winner
                        });
                    }
                }
                einlochenBracket.push(nextRound);
            }
            
            displayEinlochenTournament();
        }

        // ========================================
        // SPIEL 8: Auslandsmaus Jeans
        // ========================================

        // ========================================
        // SPIEL 7: Auktionshaus
        // ========================================

        function openAuktionshaus() {
            if (players.length < 2) {
                alert('Du brauchst mindestens 2 Spieler!');
                return;
            }

            const modal = document.getElementById('gameModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalIcon = document.getElementById('modalIcon');
            const modalBody = document.getElementById('modalBody');
            
            modalIcon.textContent = 'üî®';
            modalTitle.textContent = 'Auktionshaus';
            
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;"><img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;"></div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">üî®</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Auktionshaus</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ Ihr seht eine eBay-Auktion auf dem Bildschirm</li>
                            <li style="margin-bottom: 12px;">‚úÖ Nutzt die Sch√§tz-App, um zu raten, wie viel der Artikel gekostet hat</li>
                            <li style="margin-bottom: 12px;">‚úÖ Wer am n√§chsten dran ist, bekommt den Punkt</li>
                            <li style="margin-bottom: 12px;">‚úÖ Bei Gleichstand bekommen beide Spieler den Punkt</li>
                        </ul>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%); border-radius: 12px; padding: 20px; margin-bottom: 30px; border: 2px solid rgba(251, 191, 36, 0.3);">
                        <p style="font-size: 1.2rem; font-weight: 700; color: #fbbf24; margin: 0; line-height: 1.6;">
                            üí° Tipp: Zeigt reale eBay-Auktionen auf dem Bildschirm und lasst die Spieler den Endpreis sch√§tzen!
                        </p>
                    </div>

                    <button class="save-config-btn" onclick="closeModal()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚úì Verstanden!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        // ========================================
        // SPIEL 8: Auslandsmaus Jeans
        // ========================================

        function openAuslandsmausJeans() {
            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'üåç';
            modalTitle.textContent = 'Auslandsmaus Jeans';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;"><img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;"></div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">üåç</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Auslandsmaus Jeans</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ √ñffne das Spiel Auslandsmaus Jeans</li>
                            <li style="margin-bottom: 12px;">‚úÖ Beliebig viele Runden - wird von uns entschieden</li>
                            <li style="margin-bottom: 12px;">‚úÖ Wer am Ende die meisten Punkte hat gewinnt das Spiel</li>
                        </ul>
                    </div>

                    <button class="save-config-btn" onclick="closeModal()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚úì Verstanden!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        // ========================================
        // SPIEL 4: Higher or Lower?
        // ========================================

        let higherLowerPlayers = [];
        let higherLowerCompanies = [];
        let higherLowerPlacedCompanies = [];
        let draggedCompany = null;
        let draggedFromIndex = null;
        let lastLifeLoss = null; // Speichert letzten Leben-Verlust f√ºr Undo
        let currentCategory = 'unternehmen'; // Aktuelle Kategorie

        // Alle Kategorien mit 20 Items
        const higherLowerCategories = {
            unternehmen: [
                { name: 'Apple', value: 95, logo: 'https://cdn.simpleicons.org/apple', isImage: true },
                { name: 'Google', value: 88, logo: 'https://cdn.simpleicons.org/google', isImage: true },
                { name: 'Amazon', value: 75, logo: 'https://cdn.simpleicons.org/amazon', isImage: true },
                { name: 'Microsoft', value: 92, logo: 'https://cdn.simpleicons.org/microsoft', isImage: true },
                { name: 'Meta', value: 65, logo: 'https://cdn.simpleicons.org/meta', isImage: true },
                { name: 'Tesla', value: 70, logo: 'https://cdn.simpleicons.org/tesla', isImage: true },
                { name: 'Netflix', value: 50, logo: 'https://cdn.simpleicons.org/netflix', isImage: true },
                { name: 'Nike', value: 55, logo: 'https://cdn.simpleicons.org/nike', isImage: true },
                { name: 'McDonald\'s', value: 60, logo: 'https://cdn.simpleicons.org/mcdonalds', isImage: true },
                { name: 'Coca-Cola', value: 58, logo: 'https://cdn.simpleicons.org/cocacola', isImage: true },
                { name: 'Adidas', value: 52, logo: 'https://cdn.simpleicons.org/adidas', isImage: true },
                { name: 'BMW', value: 68, logo: 'https://cdn.simpleicons.org/bmw', isImage: true },
                { name: 'Samsung', value: 85, logo: 'https://cdn.simpleicons.org/samsung', isImage: true },
                { name: 'Sony', value: 62, logo: 'https://cdn.simpleicons.org/sony', isImage: true },
                { name: 'Spotify', value: 48, logo: 'https://cdn.simpleicons.org/spotify', isImage: true },
                { name: 'Twitter/X', value: 45, logo: 'https://cdn.simpleicons.org/x', isImage: true },
                { name: 'Intel', value: 72, logo: 'https://cdn.simpleicons.org/intel', isImage: true },
                { name: 'Starbucks', value: 56, logo: 'https://cdn.simpleicons.org/starbucks', isImage: true },
                { name: 'Disney', value: 80, logo: 'https://cdn.simpleicons.org/disney', isImage: true },
                { name: 'Pepsi', value: 54, logo: 'https://cdn.simpleicons.org/pepsi', isImage: true }
            ],
            laender: [
                { name: 'China', value: 95, logo: 'https://flagcdn.com/w80/cn.png', isImage: true },
                { name: 'Indien', value: 93, logo: 'https://flagcdn.com/w80/in.png', isImage: true },
                { name: 'USA', value: 85, logo: 'https://flagcdn.com/w80/us.png', isImage: true },
                { name: 'Indonesien', value: 75, logo: 'https://flagcdn.com/w80/id.png', isImage: true },
                { name: 'Pakistan', value: 70, logo: 'https://flagcdn.com/w80/pk.png', isImage: true },
                { name: 'Brasilien', value: 68, logo: 'https://flagcdn.com/w80/br.png', isImage: true },
                { name: 'Nigeria', value: 65, logo: 'https://flagcdn.com/w80/ng.png', isImage: true },
                { name: 'Bangladesch', value: 62, logo: 'https://flagcdn.com/w80/bd.png', isImage: true },
                { name: 'Russland', value: 60, logo: 'https://flagcdn.com/w80/ru.png', isImage: true },
                { name: 'Mexiko', value: 58, logo: 'https://flagcdn.com/w80/mx.png', isImage: true },
                { name: 'Japan', value: 56, logo: 'https://flagcdn.com/w80/jp.png', isImage: true },
                { name: '√Ñthiopien', value: 54, logo: 'https://flagcdn.com/w80/et.png', isImage: true },
                { name: 'Philippinen', value: 52, logo: 'https://flagcdn.com/w80/ph.png', isImage: true },
                { name: '√Ñgypten', value: 50, logo: 'https://flagcdn.com/w80/eg.png', isImage: true },
                { name: 'Vietnam', value: 48, logo: 'https://flagcdn.com/w80/vn.png', isImage: true },
                { name: 'T√ºrkei', value: 46, logo: 'https://flagcdn.com/w80/tr.png', isImage: true },
                { name: 'Deutschland', value: 44, logo: 'https://flagcdn.com/w80/de.png', isImage: true },
                { name: 'Thailand', value: 42, logo: 'https://flagcdn.com/w80/th.png', isImage: true },
                { name: 'Frankreich', value: 40, logo: 'https://flagcdn.com/w80/fr.png', isImage: true },
                { name: 'UK', value: 38, logo: 'https://flagcdn.com/w80/gb.png', isImage: true }
            ],
            staedte: [
                { name: 'Tokyo', value: 95, logo: 'üóº' },
                { name: 'Delhi', value: 88, logo: 'üïå' },
                { name: 'Shanghai', value: 85, logo: 'üèôÔ∏è' },
                { name: 'S√£o Paulo', value: 78, logo: 'üåÜ' },
                { name: 'Mexico City', value: 75, logo: 'üåÆ' },
                { name: 'Kairo', value: 72, logo: 'üèõÔ∏è' },
                { name: 'Mumbai', value: 70, logo: 'üé≠' },
                { name: 'Peking', value: 68, logo: 'üèØ' },
                { name: 'Dhaka', value: 65, logo: 'üèòÔ∏è' },
                { name: 'Osaka', value: 62, logo: 'üè¢' },
                { name: 'New York', value: 60, logo: 'üóΩ' },
                { name: 'Karachi', value: 58, logo: 'üïã' },
                { name: 'Buenos Aires', value: 55, logo: '‚öΩ' },
                { name: 'Istanbul', value: 52, logo: 'üïå' },
                { name: 'Kalkutta', value: 50, logo: 'üõï' },
                { name: 'Manila', value: 48, logo: 'üèñÔ∏è' },
                { name: 'Lagos', value: 45, logo: 'üå¥' },
                { name: 'Rio', value: 42, logo: 'üèñÔ∏è' },
                { name: 'Moskau', value: 40, logo: 'üèõÔ∏è' },
                { name: 'Los Angeles', value: 38, logo: 'üé¨' }
            ],
            filme: [
                { name: 'Avatar', value: 95, logo: 'üåä' },
                { name: 'Avengers Endgame', value: 92, logo: 'üí•' },
                { name: 'Avatar 2', value: 88, logo: 'üåä' },
                { name: 'Titanic', value: 85, logo: 'üö¢' },
                { name: 'Star Wars VII', value: 82, logo: '‚≠ê' },
                { name: 'Avengers Infinity War', value: 78, logo: 'üíé' },
                { name: 'Spider-Man NWH', value: 75, logo: 'üï∑Ô∏è' },
                { name: 'Jurassic World', value: 72, logo: 'ü¶ï' },
                { name: 'Lion King', value: 68, logo: 'ü¶Å' },
                { name: 'Avengers', value: 65, logo: 'ü¶∏' },
                { name: 'Fast & Furious 7', value: 62, logo: 'üèéÔ∏è' },
                { name: 'Frozen 2', value: 58, logo: '‚ùÑÔ∏è' },
                { name: 'Top Gun Maverick', value: 55, logo: '‚úàÔ∏è' },
                { name: 'Barbie', value: 52, logo: 'üíñ' },
                { name: 'Super Mario Bros', value: 50, logo: 'üçÑ' },
                { name: 'Harry Potter 7.2', value: 48, logo: '‚ö°' },
                { name: 'Frozen', value: 45, logo: '‚õÑ' },
                { name: 'Black Panther', value: 42, logo: 'üêÜ' },
                { name: 'Star Wars VIII', value: 40, logo: 'üåü' },
                { name: 'Jurassic World 2', value: 38, logo: 'ü¶ñ' }
            ],
            sozialeMedien: [
                { name: 'Facebook', value: 95, logo: 'https://cdn.simpleicons.org/facebook', isImage: true },
                { name: 'YouTube', value: 92, logo: 'https://cdn.simpleicons.org/youtube', isImage: true },
                { name: 'WhatsApp', value: 88, logo: 'https://cdn.simpleicons.org/whatsapp', isImage: true },
                { name: 'Instagram', value: 85, logo: 'https://cdn.simpleicons.org/instagram', isImage: true },
                { name: 'WeChat', value: 82, logo: 'https://cdn.simpleicons.org/wechat', isImage: true },
                { name: 'TikTok', value: 78, logo: 'https://cdn.simpleicons.org/tiktok', isImage: true },
                { name: 'Telegram', value: 72, logo: 'https://cdn.simpleicons.org/telegram', isImage: true },
                { name: 'Snapchat', value: 68, logo: 'https://cdn.simpleicons.org/snapchat', isImage: true },
                { name: 'Twitter/X', value: 65, logo: 'https://cdn.simpleicons.org/x', isImage: true },
                { name: 'Pinterest', value: 62, logo: 'https://cdn.simpleicons.org/pinterest', isImage: true },
                { name: 'Reddit', value: 58, logo: 'https://cdn.simpleicons.org/reddit', isImage: true },
                { name: 'LinkedIn', value: 55, logo: 'https://cdn.simpleicons.org/linkedin', isImage: true },
                { name: 'Discord', value: 52, logo: 'https://cdn.simpleicons.org/discord', isImage: true },
                { name: 'Twitch', value: 48, logo: 'https://cdn.simpleicons.org/twitch', isImage: true },
                { name: 'Spotify', value: 45, logo: 'https://cdn.simpleicons.org/spotify', isImage: true },
                { name: 'Threads', value: 42, logo: 'https://cdn.simpleicons.org/threads', isImage: true },
                { name: 'BeReal', value: 38, logo: 'üì∏', isImage: false },
                { name: 'Tumblr', value: 35, logo: 'https://cdn.simpleicons.org/tumblr', isImage: true },
                { name: 'Mastodon', value: 32, logo: 'https://cdn.simpleicons.org/mastodon', isImage: true },
                { name: 'Clubhouse', value: 28, logo: 'üéôÔ∏è', isImage: false }
            ],
            sportler: [
                { name: 'Cristiano Ronaldo', value: 95, logo: '‚öΩ' },
                { name: 'Lionel Messi', value: 93, logo: '‚öΩ' },
                { name: 'LeBron James', value: 88, logo: 'üèÄ' },
                { name: 'Neymar Jr', value: 85, logo: '‚öΩ' },
                { name: 'Roger Federer', value: 82, logo: 'üéæ' },
                { name: 'Tiger Woods', value: 78, logo: '‚õ≥' },
                { name: 'Serena Williams', value: 75, logo: 'üéæ' },
                { name: 'Virat Kohli', value: 72, logo: 'üèè' },
                { name: 'Tom Brady', value: 70, logo: 'üèà' },
                { name: 'Kylian Mbapp√©', value: 68, logo: '‚öΩ' },
                { name: 'Kevin Durant', value: 65, logo: 'üèÄ' },
                { name: 'Stephen Curry', value: 62, logo: 'üèÄ' },
                { name: 'Lewis Hamilton', value: 58, logo: 'üèéÔ∏è' },
                { name: 'Rafael Nadal', value: 55, logo: 'üéæ' },
                { name: 'Usain Bolt', value: 52, logo: 'üèÉ' },
                { name: 'Michael Jordan', value: 50, logo: 'üèÄ' },
                { name: 'Floyd Mayweather', value: 48, logo: 'ü•ä' },
                { name: 'Phil Mickelson', value: 45, logo: '‚õ≥' },
                { name: 'Conor McGregor', value: 42, logo: 'ü•ä' },
                { name: 'Novak Djokovic', value: 40, logo: 'üéæ' }
            ],
            youtuber: [
                { name: 'MrBeast', value: 95, logo: 'üí∞' },
                { name: 'PewDiePie', value: 92, logo: 'üëä' },
                { name: 'Rezo', value: 88, logo: 'üé¨' },
                { name: 'Julien Bam', value: 85, logo: 'üé≠' },
                { name: 'Gronkh', value: 82, logo: 'üéÆ' },
                { name: 'HeyMoritz', value: 78, logo: 'üòÇ' },
                { name: 'Paluten', value: 75, logo: 'üéÆ' },
                { name: 'Dagi Bee', value: 72, logo: 'üíÑ' },
                { name: 'Simon Unge', value: 70, logo: 'üé•' },
                { name: 'Bibis Beauty', value: 68, logo: 'üíÖ' },
                { name: 'LeFloid', value: 65, logo: 'üì∞' },
                { name: 'Freshtorge', value: 62, logo: 'üé≠' },
                { name: 'ConCrafter', value: 58, logo: '‚õèÔ∏è' },
                { name: 'Tanzverbot', value: 55, logo: 'üéµ' },
                { name: 'Inscope21', value: 52, logo: 'üí™' },
                { name: 'Apored', value: 50, logo: 'üé§' },
                { name: 'Standartskill', value: 48, logo: 'üéÆ' },
                { name: 'Trymacs', value: 45, logo: 'üéÆ' },
                { name: 'Klengan', value: 42, logo: 'üòÇ' },
                { name: 'MontanaBlack', value: 40, logo: 'üé∞' }
            ],
            musikKuenstler: [
                { name: 'Taylor Swift', value: 95, logo: 'üí´' },
                { name: 'Drake', value: 92, logo: 'ü¶â' },
                { name: 'Bad Bunny', value: 88, logo: 'üê∞' },
                { name: 'The Weeknd', value: 85, logo: 'üåô' },
                { name: 'Ed Sheeran', value: 82, logo: 'üé∏' },
                { name: 'Ariana Grande', value: 78, logo: '‚òÅÔ∏è' },
                { name: 'Justin Bieber', value: 75, logo: 'üé§' },
                { name: 'Billie Eilish', value: 72, logo: 'üíö' },
                { name: 'BTS', value: 70, logo: 'üíú' },
                { name: 'Post Malone', value: 68, logo: 'üåπ' },
                { name: 'Eminem', value: 65, logo: 'üé§' },
                { name: 'Rihanna', value: 62, logo: 'üíé' },
                { name: 'Beyonc√©', value: 60, logo: 'üëë' },
                { name: 'Bruno Mars', value: 58, logo: 'üé©' },
                { name: 'Lady Gaga', value: 55, logo: 'ü¶Ñ' },
                { name: 'Kanye West', value: 52, logo: 'üêª' },
                { name: 'Dua Lipa', value: 50, logo: 'üíÉ' },
                { name: 'Shawn Mendes', value: 48, logo: 'üé∏' },
                { name: 'Coldplay', value: 45, logo: 'üåà' },
                { name: 'Imagine Dragons', value: 42, logo: 'üêâ' }
            ],
            videospiele: [
                { name: 'Minecraft', value: 95, logo: '‚õèÔ∏è' },
                { name: 'GTA V', value: 92, logo: 'üöó' },
                { name: 'Tetris', value: 88, logo: 'üü¶' },
                { name: 'Wii Sports', value: 85, logo: 'üéæ' },
                { name: 'PUBG', value: 82, logo: 'üî´' },
                { name: 'Mario Kart 8', value: 78, logo: 'üèéÔ∏è' },
                { name: 'Red Dead 2', value: 75, logo: 'ü§†' },
                { name: 'Pok√©mon', value: 72, logo: '‚ö°' },
                { name: 'Terraria', value: 68, logo: '‚õèÔ∏è' },
                { name: 'The Witcher 3', value: 65, logo: '‚öîÔ∏è' },
                { name: 'Call of Duty MW', value: 62, logo: 'üéñÔ∏è' },
                { name: 'Among Us', value: 58, logo: 'üëæ' },
                { name: 'Fortnite', value: 55, logo: 'üéÆ' },
                { name: 'The Last of Us', value: 52, logo: 'üßü' },
                { name: 'Zelda BOTW', value: 50, logo: 'üó°Ô∏è' },
                { name: 'God of War', value: 48, logo: '‚ö°' },
                { name: 'Overwatch', value: 45, logo: 'üéØ' },
                { name: 'Super Smash Bros', value: 42, logo: 'ü•ä' },
                { name: 'Animal Crossing', value: 40, logo: 'üèùÔ∏è' },
                { name: 'FIFA', value: 38, logo: '‚öΩ' }
            ],
            apps: [
                { name: 'WhatsApp', value: 95, logo: 'https://cdn.simpleicons.org/whatsapp', isImage: true },
                { name: 'Facebook', value: 92, logo: 'https://cdn.simpleicons.org/facebook', isImage: true },
                { name: 'Instagram', value: 88, logo: 'https://cdn.simpleicons.org/instagram', isImage: true },
                { name: 'TikTok', value: 85, logo: 'https://cdn.simpleicons.org/tiktok', isImage: true },
                { name: 'Telegram', value: 82, logo: 'https://cdn.simpleicons.org/telegram', isImage: true },
                { name: 'Snapchat', value: 78, logo: 'https://cdn.simpleicons.org/snapchat', isImage: true },
                { name: 'Messenger', value: 75, logo: 'https://cdn.simpleicons.org/messenger', isImage: true },
                { name: 'WeChat', value: 72, logo: 'https://cdn.simpleicons.org/wechat', isImage: true },
                { name: 'Google Maps', value: 70, logo: 'https://cdn.simpleicons.org/googlemaps', isImage: true },
                { name: 'Spotify', value: 68, logo: 'https://cdn.simpleicons.org/spotify', isImage: true },
                { name: 'Netflix', value: 65, logo: 'https://cdn.simpleicons.org/netflix', isImage: true },
                { name: 'Gmail', value: 62, logo: 'https://cdn.simpleicons.org/gmail', isImage: true },
                { name: 'YouTube', value: 60, logo: 'https://cdn.simpleicons.org/youtube', isImage: true },
                { name: 'Twitter/X', value: 58, logo: 'https://cdn.simpleicons.org/x', isImage: true },
                { name: 'Amazon', value: 55, logo: 'https://cdn.simpleicons.org/amazon', isImage: true },
                { name: 'Uber', value: 52, logo: 'https://cdn.simpleicons.org/uber', isImage: true },
                { name: 'PayPal', value: 50, logo: 'https://cdn.simpleicons.org/paypal', isImage: true },
                { name: 'Shazam', value: 48, logo: 'https://cdn.simpleicons.org/shazam', isImage: true },
                { name: 'Pinterest', value: 45, logo: 'https://cdn.simpleicons.org/pinterest', isImage: true },
                { name: 'LinkedIn', value: 42, logo: 'https://cdn.simpleicons.org/linkedin', isImage: true }
            ],
            sehenswuerdigkeiten: [
                { name: 'Eiffelturm', value: 95, logo: 'üóº' },
                { name: 'Freiheitsstatue', value: 92, logo: 'üóΩ' },
                { name: 'Kolosseum', value: 88, logo: 'üèõÔ∏è' },
                { name: 'Taj Mahal', value: 85, logo: 'üïå' },
                { name: 'Chinesische Mauer', value: 82, logo: 'üèØ' },
                { name: 'Big Ben', value: 78, logo: 'üï∞Ô∏è' },
                { name: 'Sagrada Familia', value: 75, logo: '‚õ™' },
                { name: 'Machu Picchu', value: 72, logo: 'üèîÔ∏è' },
                { name: 'Pyramiden', value: 70, logo: 'üî∫' },
                { name: 'Stonehenge', value: 68, logo: 'üóø' },
                { name: 'Akropolis', value: 65, logo: 'üèõÔ∏è' },
                { name: 'Mount Everest', value: 62, logo: 'üèîÔ∏è' },
                { name: 'Golden Gate', value: 60, logo: 'üåâ' },
                { name: 'Petersdom', value: 58, logo: '‚õ™' },
                { name: 'Burj Khalifa', value: 55, logo: 'üèôÔ∏è' },
                { name: 'Neuschwanstein', value: 52, logo: 'üè∞' },
                { name: 'Sydney Opera', value: 50, logo: 'üé≠' },
                { name: 'Tower Bridge', value: 48, logo: 'üåâ' },
                { name: 'Brandenburger Tor', value: 45, logo: 'üö™' },
                { name: 'Angkor Wat', value: 42, logo: 'üèõÔ∏è' }
            ]
        };

        function openHigherOrLower() {
            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'üìä';
            modalTitle.textContent = 'Higher or Lower?';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üìä</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Higher or Lower?</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ Der Spieler mit den niedrigsten Punkten f√§ngt an</li>
                            <li style="margin-bottom: 12px;">‚úÖ Dann geht es im Uhrzeigersinn herum</li>
                            <li style="margin-bottom: 12px;">‚úÖ Ein Unternehmen ist bereits vorgegeben</li>
                            <li style="margin-bottom: 12px;">‚úÖ Ziehe Unternehmen per Drag & Drop in den oberen Bereich</li>
                            <li style="margin-bottom: 12px;">‚úÖ Platziere sie links (Lower), rechts (Higher) oder dazwischen</li>
                            <li style="margin-bottom: 12px;">‚úÖ Bei falscher Platzierung verliert der Spieler ein Leben</li>
                        </ul>
                    </div>

                    <button class="save-config-btn" onclick="startHigherOrLower()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚ñ∂Ô∏è Spiel starten
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function startHigherOrLower() {
            if (players.length < 2) {
                alert('Du brauchst mindestens 2 Spieler!');
                return;
            }

            // Initialisiere Spieler mit 2 Leben (nur beim ersten Start)
            if (higherLowerPlayers.length === 0) {
                higherLowerPlayers = players.map(p => ({ 
                    name: p.name, 
                    lives: 2,
                    score: 0 
                }));
            }

            lastLifeLoss = null;

            // Lade aktuelle Kategorie
            loadCategory(currentCategory);

            showHigherOrLowerGameView();
        }

        function loadCategory(categoryName) {
            currentCategory = categoryName;
            
            // Kopiere Kategorie-Daten
            higherLowerCompanies = [...higherLowerCategories[categoryName]];
            
            // Mische Unternehmen und w√§hle ein Start-Item
            higherLowerCompanies = higherLowerCompanies.sort(() => Math.random() - 0.5);
            higherLowerPlacedCompanies = [higherLowerCompanies.pop()];
            
            // Aktualisiere Kategorie-Info
            updateCategoryInfo();
        }

        function updateCategoryInfo() {
            const categoryInfo = document.getElementById('categoryInfo');
            if (!categoryInfo) return;
            
            const categoryInfoTexts = {
                'unternehmen': 'üìä Markenwert (in Mrd. $)',
                'laender': 'üë• Einwohnerzahl (in Mio.)',
                'staedte': 'üèôÔ∏è Einwohnerzahl (in Mio.)',
                'filme': 'üí∞ Box Office Einnahmen (in Mrd. $)',
                'sozialeMedien': 'üë• Aktive Nutzer (in Mio.)',
                'sportler': 'üì± Instagram Follower (in Mio.)',
                'youtuber': 'üì∫ YouTube Abonnenten (in Mio.)',
                'musikKuenstler': 'üéß Spotify H√∂rer (in Mio.)',
                'videospiele': 'üéÆ Verk√§ufe (in Mio. Kopien)',
                'apps': 'üì≤ Downloads (in Mio.)',
                'sehenswuerdigkeiten': 'üß≥ Besucher pro Jahr (in Mio.)'
            };
            
            categoryInfo.textContent = categoryInfoTexts[currentCategory] || 'üìä Vergleichswert';
        }

        function changeCategory() {
            const select = document.getElementById('categorySelect');
            const newCategory = select.value;
            
            // Zeige Best√§tigungs-Modal
            showCategoryChangeModal(newCategory);
        }

        function showCategoryChangeModal(newCategory) {
            // Erstelle Overlay
            const overlay = document.createElement('div');
            overlay.className = 'feedback-overlay';
            
            // Erstelle Modal
            const modal = document.createElement('div');
            modal.className = 'feedback-modal';
            modal.style.border = '4px solid #7c3aed';
            modal.style.boxShadow = '0 20px 60px rgba(124, 58, 237, 0.5)';
            
            // Kategorie-Namen f√ºr Display
            const categoryNames = {
                'unternehmen': 'üè¢ Unternehmen',
                'laender': 'üåç L√§nder',
                'staedte': 'üèôÔ∏è St√§dte',
                'filme': 'üé¨ Filme',
                'sozialeMedien': 'üì± Soziale Medien',
                'sportler': '‚öΩ Sportler',
                'youtuber': 'üì∫ YouTuber',
                'musikKuenstler': 'üéµ Musik-K√ºnstler',
                'videospiele': 'üéÆ Videospiele',
                'apps': 'üì≤ Apps',
                'sehenswuerdigkeiten': 'üóø Sehensw√ºrdigkeiten'
            };
            
            modal.innerHTML = `
                <div class="feedback-icon">üîÑ</div>
                <div class="feedback-text">Kategorie wechseln?</div>
                <div class="feedback-details">Wechseln zu:<br><strong>${categoryNames[newCategory]}</strong><br><br>Die aktuellen Items werden zur√ºckgesetzt,<br>aber deine Leben bleiben erhalten.</div>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="save-config-btn" onclick="confirmCategoryChange('${newCategory}')" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); flex: 1;">
                        ‚úì Ja, wechseln
                    </button>
                    <button class="save-config-btn" onclick="cancelCategoryChange()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); flex: 1;">
                        ‚úó Abbrechen
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        function confirmCategoryChange(newCategory) {
            loadCategory(newCategory);
            updateHigherOrLowerDisplay();
            closeCategoryChangeModal();
        }

        function cancelCategoryChange() {
            // Setze Select zur√ºck
            const select = document.getElementById('categorySelect');
            select.value = currentCategory;
            closeCategoryChangeModal();
        }

        function closeCategoryChangeModal() {
            const overlay = document.querySelector('.feedback-overlay');
            const modal = document.querySelector('.feedback-modal');
            
            if (overlay) overlay.remove();
            if (modal) modal.remove();
        }

        function showHigherOrLowerGameView() {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; gap: 20px; height: 100%; min-height: 700px;">
                    <!-- Linke Sidebar -->
                    <div style="width: 250px; display: flex; flex-direction: column; gap: 15px;">
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üèÜ Punkte</h3>
                            <div id="higherLowerScoreList"></div>
                        </div>
                        
                        <div class="info-card">
                            <h3 style="margin-bottom: 10px; font-size: 1.1rem; color: #ffffff;">üìÇ Kategorie</h3>
                            <select id="categorySelect" onchange="changeCategory()" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 8px; color: white; font-size: 0.95rem; cursor: pointer; margin-bottom: 10px;">
                                <option value="unternehmen" style="background: #1a1f3a; color: white;">üè¢ Unternehmen</option>
                                <option value="laender" style="background: #1a1f3a; color: white;">üåç L√§nder</option>
                                <option value="staedte" style="background: #1a1f3a; color: white;">üèôÔ∏è St√§dte</option>
                                <option value="filme" style="background: #1a1f3a; color: white;">üé¨ Filme</option>
                                <option value="sozialeMedien" style="background: #1a1f3a; color: white;">üì± Soziale Medien</option>
                                <option value="sportler" style="background: #1a1f3a; color: white;">‚öΩ Sportler</option>
                                <option value="youtuber" style="background: #1a1f3a; color: white;">üì∫ YouTuber</option>
                                <option value="musikKuenstler" style="background: #1a1f3a; color: white;">üéµ Musik-K√ºnstler</option>
                                <option value="videospiele" style="background: #1a1f3a; color: white;">üéÆ Videospiele</option>
                                <option value="apps" style="background: #1a1f3a; color: white;">üì≤ Apps</option>
                                <option value="sehenswuerdigkeiten" style="background: #1a1f3a; color: white;">üóø Sehensw√ºrdigkeiten</option>
                            </select>
                            <div id="categoryInfo" style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); text-align: center; font-style: italic;">
                                üìä Markenwert (in Mrd. $)
                            </div>
                        </div>
                        
                        <button class="control-btn-full danger" onclick="endHigherOrLower()">üèÅ Spiel beenden</button>
                    </div>

                    <!-- Hauptbereich -->
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 20px; overflow-y: auto;">
                        <!-- Zahlenstrahl -->
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                                <span>‚¨áÔ∏è Wenig</span>
                                <span>‚¨ÜÔ∏è Viel</span>
                            </div>
                            <div style="position: relative; height: 60px; background: linear-gradient(90deg, #ef4444 0%, #fbbf24 50%, #22c55e 100%); border-radius: 12px; margin-bottom: 20px;">
                                <!-- Gradient-Linie als Zahlenstrahl -->
                            </div>
                            
                            <!-- Drop Zone f√ºr platzierte Unternehmen -->
                            <div id="placedCompanies" 
                                 ondrop="handleDrop(event)" 
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 style="display: flex; gap: 10px; min-height: 140px; padding: 15px; background: rgba(255, 255, 255, 0.03); border-radius: 12px; border: 2px dashed rgba(255, 255, 255, 0.2); position: relative;">
                                <div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: rgba(255, 255, 255, 0.5); font-size: 0.9rem; pointer-events: none;">
                                    Ziehe Items hierher
                                </div>
                            </div>
                        </div>

                        <!-- Verf√ºgbare Items -->
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 20px;">
                            <h3 style="margin-bottom: 15px; font-size: 1.2rem; color: #ffffff;">üì¶ Verf√ºgbare Items</h3>
                            <div id="availableCompanies" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; max-height: 300px; overflow-y: auto; padding-right: 5px;">
                                <!-- Hier werden verf√ºgbare Items angezeigt -->
                            </div>
                        </div>

                        <!-- Spieler mit Leben - kompakt und zentriert -->
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 15px;">
                            <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 10px; gap: 10px;">
                                <h3 style="font-size: 1.1rem; margin: 0; color: #ffffff;">üë• Spieler</h3>
                                <button id="undoButton" onclick="undoLifeLoss()" style="background: rgba(239, 68, 68, 0.3); border: 2px solid rgba(239, 68, 68, 0.5); border-radius: 8px; padding: 6px 12px; color: white; cursor: pointer; font-size: 0.85rem; font-weight: 600; opacity: 0.5; pointer-events: none;">
                                    ‚Ü©Ô∏è R√ºckg√§ngig
                                </button>
                                <button onclick="showHigherOrLowerResult()" style="background: rgba(34, 197, 94, 0.3); border: 2px solid rgba(34, 197, 94, 0.5); border-radius: 8px; padding: 6px 12px; color: white; cursor: pointer; font-size: 0.85rem; font-weight: 600;">
                                    üèÜ Ergebnis
                                </button>
                            </div>
                            <div id="playerLives" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                                <!-- Hier werden Spieler angezeigt -->
                            </div>
                        </div>
                    </div>
                </div>
            `;

            updateHigherOrLowerDisplay();
        }

        function updateHigherOrLowerDisplay() {
            // Update Score List
            const scoreList = document.getElementById('higherLowerScoreList');
            if (scoreList) {
                const sorted = [...higherLowerPlayers].sort((a, b) => b.score - a.score);
                scoreList.innerHTML = sorted.map(player => `
                    <div class="game-player-item">
                        <span class="game-player-name">${player.name}</span>
                        <span class="game-player-score">${player.score}</span>
                    </div>
                `).join('');
            }

            // Update Placed Companies
            const placedContainer = document.getElementById('placedCompanies');
            if (placedContainer && higherLowerPlacedCompanies.length > 0) {
                placedContainer.innerHTML = higherLowerPlacedCompanies.map((company, index) => {
                    let logoHTML = '';
                    if (company.isImage) {
                        // Zeige Bild
                        logoHTML = `<img src="${company.logo}" alt="${company.name}" style="width: 40px; height: 40px; object-fit: contain; margin-bottom: 5px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                    <div style="font-size: 1.8rem; display: none;">üè¢</div>`;
                    } else {
                        // Zeige Emoji
                        logoHTML = company.logo;
                    }
                    
                    return `
                        <div draggable="false" style="background: rgba(124, 58, 237, 0.4); border: 2px solid rgba(124, 58, 237, 0.6); border-radius: 12px; padding: 15px; text-align: center; min-width: 100px;">
                            <div style="font-size: 2rem; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; min-height: 40px;">${logoHTML}</div>
                            <div style="font-size: 0.85rem; font-weight: 600; color: #ffffff; line-height: 1.2; word-wrap: break-word; overflow-wrap: break-word; hyphens: auto;">${company.name}</div>
                            <div style="font-size: 1.2rem; color: #22c55e; margin-top: 5px; font-weight: 700;">${company.value}</div>
                        </div>
                    `;
                }).join('');
            }

            // Update Available Companies
            const availableContainer = document.getElementById('availableCompanies');
            if (availableContainer) {
                availableContainer.innerHTML = higherLowerCompanies.map((company, index) => {
                    let logoHTML = '';
                    if (company.isImage) {
                        // Zeige Bild
                        logoHTML = `<img src="${company.logo}" alt="${company.name}" style="width: 50px; height: 50px; object-fit: contain; margin-bottom: 8px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                    <div style="font-size: 2rem; display: none;">üè¢</div>`;
                    } else {
                        // Zeige Emoji
                        logoHTML = company.logo;
                    }
                    
                    return `
                        <div draggable="true" 
                             ondragstart="handleDragStart(event, ${index})"
                             ondragend="handleDragEnd(event)"
                             class="company-card"
                             style="background: rgba(59, 130, 246, 0.3); border: 2px solid rgba(59, 130, 246, 0.5); border-radius: 12px; padding: 12px; transition: all 0.3s; text-align: center;"
                             onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(59, 130, 246, 0.8)';"
                             onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(59, 130, 246, 0.5)';">
                            <div style="font-size: 2.5rem; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; min-height: 50px;">${logoHTML}</div>
                            <div style="font-size: 0.9rem; font-weight: 700; color: #ffffff; line-height: 1.2; word-wrap: break-word; overflow-wrap: break-word; hyphens: auto;">${company.name}</div>
                            <div style="font-size: 0.75rem; color: #fbbf24; margin-top: 5px; font-weight: 600;">‚ùì Wert?</div>
                        </div>
                    `;
                }).join('');
            }

            // Update Player Lives - kompakter
            const playerLivesContainer = document.getElementById('playerLives');
            if (playerLivesContainer) {
                playerLivesContainer.innerHTML = higherLowerPlayers.map((player, index) => `
                    <button onclick="loseLife(${index})" style="background: ${player.lives === 0 ? 'rgba(100, 100, 100, 0.3)' : 'rgba(34, 197, 94, 0.3)'}; border: 2px solid ${player.lives === 0 ? 'rgba(100, 100, 100, 0.5)' : 'rgba(34, 197, 94, 0.5)'}; border-radius: 10px; padding: 10px 15px; cursor: ${player.lives === 0 ? 'not-allowed' : 'pointer'}; transition: all 0.3s; opacity: ${player.lives === 0 ? '0.5' : '1'};"
                        ${player.lives === 0 ? '' : 'onmouseover="this.style.transform=\'scale(1.05)\';" onmouseout="this.style.transform=\'scale(1)\';"'}>
                        <div style="font-size: 1rem; font-weight: 700; color: #ffffff; margin-bottom: 3px;">${player.name}</div>
                        <div style="font-size: 1.3rem;">${'‚ù§Ô∏è'.repeat(player.lives)}${'üñ§'.repeat(2 - player.lives)}</div>
                    </button>
                `).join('');
            }

            // Update Undo Button
            const undoButton = document.getElementById('undoButton');
            if (undoButton) {
                if (lastLifeLoss !== null) {
                    undoButton.style.opacity = '1';
                    undoButton.style.pointerEvents = 'auto';
                } else {
                    undoButton.style.opacity = '0.5';
                    undoButton.style.pointerEvents = 'none';
                }
            }
        }

        function handleDragStart(event, index) {
            draggedCompany = higherLowerCompanies[index];
            draggedFromIndex = index;
            console.log('=== DRAG START ===');
            console.log('Gezogenes Unternehmen:', draggedCompany);
            console.log('Index:', index);
            event.currentTarget.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/plain', index);
        }

        function handleDragEnd(event) {
            console.log('=== DRAG END ===');
            event.currentTarget.classList.remove('dragging');
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.dataTransfer.dropEffect = 'move';
            
            const dropZone = event.currentTarget;
            if (!dropZone.classList.contains('drag-over')) {
                dropZone.classList.add('drag-over');
                console.log('Drag Over - Drop Zone aktiviert');
            }
            return false; // Wichtig f√ºr manche Browser
        }

        function handleDragLeave(event) {
            if (event.target === event.currentTarget) {
                event.currentTarget.classList.remove('drag-over');
                console.log('Drag Leave - Drop Zone deaktiviert');
            }
        }

        function handleDrop(event) {
            console.log('=== DROP EVENT TRIGGERED ===');
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('drag-over');
            
            if (!draggedCompany) {
                console.error('FEHLER: Kein Unternehmen gezogen!');
                alert('Fehler: Kein Unternehmen ausgew√§hlt');
                return false;
            }

            console.log('Gezogenes Unternehmen:', draggedCompany.name);
            console.log('Aktuelle platzierte Unternehmen:', higherLowerPlacedCompanies.length);

            // Bestimme Position basierend auf X-Koordinate
            const dropZone = event.currentTarget;
            const rect = dropZone.getBoundingClientRect();
            const dropX = event.clientX - rect.left;
            
            console.log('Drop X-Position:', dropX, 'von', rect.width);
            
            // Finde die richtige Position im Array
            let insertIndex = 0;
            
            // Durchsuche nur die tats√§chlichen Company-Cards
            const companyCards = Array.from(dropZone.children).filter(child => {
                // Filtere den Hinweistext heraus (hat pointer-events: none)
                const hasPointerEvents = window.getComputedStyle(child).pointerEvents !== 'none';
                return hasPointerEvents && child.style.background && child.style.background.includes('124, 58, 237');
            });
            
            console.log('Gefundene Company Cards:', companyCards.length);
            
            for (let i = 0; i < companyCards.length; i++) {
                const card = companyCards[i];
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2 - rect.left;
                
                console.log(`Card ${i} Center:`, cardCenter);
                
                if (dropX > cardCenter) {
                    insertIndex = i + 1;
                }
            }

            console.log('Berechneter Insert Index:', insertIndex, 'von max', higherLowerPlacedCompanies.length);

            // Pr√ºfe ob Platzierung korrekt ist
            const isCorrect = checkPlacement(draggedCompany, insertIndex);
            console.log('Platzierung korrekt?', isCorrect);

            if (isCorrect) {
                console.log('‚úì RICHTIG - F√ºge hinzu');
                // Richtig - f√ºge Unternehmen hinzu
                higherLowerPlacedCompanies.splice(insertIndex, 0, draggedCompany);
                higherLowerCompanies.splice(draggedFromIndex, 1);
                
                showFeedbackModal(true, draggedCompany.name, draggedCompany.value);
            } else {
                console.log('‚úó FALSCH');
                // Falsch - keine Details anzeigen
                showFeedbackModal(false, draggedCompany.name, null);
            }

            draggedCompany = null;
            draggedFromIndex = null;

            // Pr√ºfe ob Spiel zu Ende
            if (higherLowerCompanies.length === 0) {
                setTimeout(() => endHigherOrLower(), 2000);
            }
            
            return false;
        }

        function showFeedbackModal(isCorrect, companyName, value) {
            // Erstelle Overlay
            const overlay = document.createElement('div');
            overlay.className = 'feedback-overlay';
            
            // Erstelle Modal
            const modal = document.createElement('div');
            modal.className = `feedback-modal ${isCorrect ? 'feedback-correct' : 'feedback-wrong'}`;
            
            if (isCorrect) {
                modal.innerHTML = `
                    <div class="feedback-icon">‚úì</div>
                    <div class="feedback-text">Richtig!</div>
                    <div class="feedback-details">${companyName}<br>Wert: ${value}</div>
                    <button class="save-config-btn" onclick="closeFeedbackModal()" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                        Weiter
                    </button>
                `;
            } else {
                modal.innerHTML = `
                    <div class="feedback-icon">‚úó</div>
                    <div class="feedback-text">Falsch!</div>
                    <div class="feedback-details">${companyName}</div>
                    <button class="save-config-btn" onclick="closeFeedbackModal()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                        Weiter
                    </button>
                `;
            }
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
            
            // Update Display nach korrekter Platzierung
            if (isCorrect) {
                updateHigherOrLowerDisplay();
            }
        }

        function closeFeedbackModal() {
            const overlay = document.querySelector('.feedback-overlay');
            const modal = document.querySelector('.feedback-modal');
            
            if (overlay) overlay.remove();
            if (modal) modal.remove();
        }

        function checkPlacement(company, insertIndex) {
            // Pr√ºfe ob das Unternehmen an der richtigen Stelle platziert wurde
            const leftNeighbor = higherLowerPlacedCompanies[insertIndex - 1];
            const rightNeighbor = higherLowerPlacedCompanies[insertIndex];

            // Am Anfang platziert
            if (insertIndex === 0) {
                return !rightNeighbor || company.value <= rightNeighbor.value;
            }
            
            // Am Ende platziert
            if (insertIndex === higherLowerPlacedCompanies.length) {
                return !leftNeighbor || company.value >= leftNeighbor.value;
            }
            
            // Dazwischen platziert
            return company.value >= leftNeighbor.value && company.value <= rightNeighbor.value;
        }

        function findCorrectPosition(company) {
            for (let i = 0; i <= higherLowerPlacedCompanies.length; i++) {
                const leftNeighbor = higherLowerPlacedCompanies[i - 1];
                const rightNeighbor = higherLowerPlacedCompanies[i];

                if (i === 0 && (!rightNeighbor || company.value <= rightNeighbor.value)) {
                    return 'Ganz links (Lower)';
                }
                
                if (i === higherLowerPlacedCompanies.length && (!leftNeighbor || company.value >= leftNeighbor.value)) {
                    return 'Ganz rechts (Higher)';
                }
                
                if (leftNeighbor && rightNeighbor && company.value >= leftNeighbor.value && company.value <= rightNeighbor.value) {
                    return `Zwischen ${leftNeighbor.name} und ${rightNeighbor.name}`;
                }
            }
            return 'Unbekannt';
        }

        function loseLife(playerIndex) {
            if (higherLowerPlayers[playerIndex].lives > 0) {
                // Speichere f√ºr Undo
                lastLifeLoss = {
                    playerIndex: playerIndex,
                    previousLives: higherLowerPlayers[playerIndex].lives
                };
                
                higherLowerPlayers[playerIndex].lives--;
                updateHigherOrLowerDisplay();
            }
        }

        function undoLifeLoss() {
            if (lastLifeLoss !== null) {
                higherLowerPlayers[lastLifeLoss.playerIndex].lives = lastLifeLoss.previousLives;
                lastLifeLoss = null;
                updateHigherOrLowerDisplay();
            }
        }

        function showHigherOrLowerResult() {
            // Vergebe Punkte basierend auf verbleibenden Leben
            higherLowerPlayers.forEach(player => {
                player.score += player.lives; // 2 Leben = 2 Punkte, 1 Leben = 1 Punkt, 0 Leben = 0 Punkte
            });
            
            // Sortiere Spieler nach Punkten (absteigend)
            const sortedPlayers = [...higherLowerPlayers].sort((a, b) => b.score - a.score);
            
            // Erstelle Overlay
            const overlay = document.createElement('div');
            overlay.className = 'feedback-overlay';
            overlay.onclick = () => {
                overlay.remove();
                modal.remove();
            };
            
            // Erstelle Modal
            const modal = document.createElement('div');
            modal.className = 'feedback-modal';
            modal.style.border = '4px solid #fbbf24';
            modal.style.boxShadow = '0 20px 60px rgba(251, 191, 36, 0.5)';
            modal.style.minWidth = '500px';
            
            // Medaillen f√ºr Top 3
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            
            modal.innerHTML = `
                <div class="feedback-icon">üèÜ</div>
                <div class="feedback-text">Runden-Ergebnis</div>
                <div style="margin: 20px 0; color: rgba(255, 255, 255, 0.9);">
                    ${sortedPlayers.map((player, index) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; margin: 8px 0; background: rgba(255, 255, 255, 0.1); border-radius: 10px; border: 2px solid ${player.lives === 2 ? '#22c55e' : player.lives === 1 ? '#fbbf24' : '#ef4444'};">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">${index < 3 ? medals[index] : 'üë§'}</span>
                                <span style="font-weight: 700; font-size: 1.1rem;">${player.name}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <span style="font-size: 1.2rem;">${'‚ù§Ô∏è'.repeat(player.lives)}${'üñ§'.repeat(2 - player.lives)}</span>
                                <span style="font-weight: 700; font-size: 1.2rem; color: #fbbf24;">+${player.lives} Punkt${player.lives !== 1 ? 'e' : ''}</span>
                                <span style="font-weight: 700; font-size: 1.3rem; color: #22c55e;">= ${player.score} üèÜ</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
                    <button class="save-config-btn" onclick="continueHigherOrLower()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); flex: 1;">
                        ‚ñ∂Ô∏è Weiter spielen
                    </button>
                    <button class="save-config-btn" onclick="endHigherOrLower()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); flex: 1;">
                        üèÅ Spiel beenden
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        function continueHigherOrLower() {
            // Schlie√üe Modal
            const overlay = document.querySelector('.feedback-overlay');
            const modal = document.querySelector('.feedback-modal');
            if (overlay) overlay.remove();
            if (modal) modal.remove();
            
            // Setze Leben zur√ºck auf 2 f√ºr alle Spieler
            higherLowerPlayers.forEach(player => {
                player.lives = 2;
            });
            
            // Lade Kategorie neu
            loadCategory(currentCategory);
            updateHigherOrLowerDisplay();
        }

        function endHigherOrLower() {
            const modalBody = document.getElementById('modalBody');
            const sorted = [...higherLowerPlayers].sort((a, b) => b.lives - a.lives);
            
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 40px;">
                    <h2 style="font-size: 3rem; margin-bottom: 30px;">üìä Higher or Lower - Endergebnis</h2>
                    
                    <div style="max-width: 600px; margin: 0 auto;">
                        ${sorted.map((player, index) => {
                            const rank = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                            
                            return `
                                <div class="final-player-item">
                                    <span class="final-player-rank">${rank}</span>
                                    <span class="final-player-name">${player.name}</span>
                                    <span class="final-player-score">${'‚ù§Ô∏è'.repeat(player.lives)}${'üñ§'.repeat(2 - player.lives)}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <button class="save-config-btn" onclick="closeModal()" style="margin-top: 40px;">
                        Zur√ºck zur √úbersicht
                    </button>
                </div>
            `;
        }

        function openHigherOrLower() {
            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'üìä';
            modalTitle.textContent = 'Higher or Lower?';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üìä</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Higher or Lower?</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ Der Spieler mit den niedrigsten Punkten f√§ngt an</li>
                            <li style="margin-bottom: 12px;">‚úÖ Dann geht es im Uhrzeigersinn herum</li>
                            <li style="margin-bottom: 12px;">‚úÖ Ein Unternehmen ist bereits vorgegeben</li>
                            <li style="margin-bottom: 12px;">‚úÖ Ziehe Unternehmen per Drag & Drop in den oberen Bereich</li>
                            <li style="margin-bottom: 12px;">‚úÖ Platziere sie links (Lower), rechts (Higher) oder dazwischen</li>
                            <li style="margin-bottom: 12px;">‚úÖ Bei falscher Platzierung verliert der Spieler ein Leben</li>
                        </ul>
                    </div>

                    <button class="save-config-btn" onclick="startHigherOrLower()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚ñ∂Ô∏è Spiel starten
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }


        // ========================================
        // SPIEL 9: EL FINALE
        // ========================================

        let elFinalePlayers = [];
        let elFinaleCategories = [
            // Normale Kategorien (100-500 Punkte)
            { name: "Kategorie 1", questions: [], isDouble: false },
            { name: "Kategorie 2", questions: [], isDouble: false },
            { name: "Kategorie 3", questions: [], isDouble: false },
            { name: "Kategorie 4", questions: [], isDouble: false },
            { name: "Kategorie 5", questions: [], isDouble: false },
            // Doppelte Kategorien (200-1000 Punkte)
            { name: "Doppelt 1", questions: [], isDouble: true },
            { name: "Doppelt 2", questions: [], isDouble: true },
            { name: "Doppelt 3", questions: [], isDouble: true },
            { name: "Doppelt 4", questions: [], isDouble: true },
            { name: "Doppelt 5", questions: [], isDouble: true }
        ];
        let usedQuestions = new Set(); // Speichert bereits ge√∂ffnete Fragen
        let currentElFinalePage = 1; // 1 = normale Kategorien, 2 = doppelte Kategorien

        // Lade gespeicherte Kategorien beim Start
        function loadElFinaleCategories() {
            const saved = localStorage.getItem('elFinaleCategories');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if (Array.isArray(parsed) && parsed.length === 10) {
                        elFinaleCategories = parsed;
                    }
                } catch (e) {
                    console.error('Fehler beim Laden der Kategorien:', e);
                }
            }
        }

        // Speichere Kategorien
        function saveElFinaleCategories() {
            localStorage.setItem('elFinaleCategories', JSON.stringify(elFinaleCategories));
        }

        function openElFinale() {
            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'üèÜ';
            modalTitle.textContent = 'EL FINALE';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;"><img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;"></div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">üèÜ</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">EL FINALE</h2>
                    
                    <div style="text-align: center; background: rgba(255, 215, 0, 0.1); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffd700;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ √ñffnet die Buzzer App</li>
                            <li style="margin-bottom: 12px;">‚úÖ Der Spieler mit den wenigsten Punkten f√§ngt an - dann im Uhrzeigersinn herum</li>
                            <li style="margin-bottom: 12px;">‚úÖ Ihr seht verschiedene Kategorien und Punktzahlen</li>
                            <li style="margin-bottom: 12px;">‚úÖ Umso h√∂her die Punktzahl, desto schwieriger die Antwort</li>
                            <li style="margin-bottom: 12px;">‚ö†Ô∏è Beantwortet der Spieler die Frage falsch, bekommt er 50% der Frage-Punkte abgezogen und die Frage wird f√ºr alle anderen Spieler freigegeben</li>
                            <li style="margin-bottom: 12px;">‚ö†Ô∏è Auch hier gilt wieder: Wer falsch antwortet bekommt Minuspunkte</li>
                        </ul>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                        <p style="font-size: 1.3rem; font-weight: 700; color: #ffd700; margin: 0;">
                            üéØ Das gro√üe Finale! Letzte Chance auf Punkte!
                        </p>
                    </div>

                    <button class="save-config-btn" onclick="startElFinale()" style="font-size: 1.2rem; padding: 18px 50px; background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); color: #000;">
                        ‚úì Verstanden - Let's go!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function startElFinale() {
            if (players.length < 2) {
                alert('Du brauchst mindestens 2 Spieler!');
                return;
            }

            // Lade gespeicherte Kategorien
            loadElFinaleCategories();

            // Initialisiere Spieler mit 0 Punkten
            elFinalePlayers = players.map(p => ({ name: p.name, score: 0 }));
            usedQuestions.clear();
            currentElFinalePage = 1;

            showElFinaleGameView();
        }

        function showElFinaleGameView() {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; gap: 20px; height: 100%; min-height: 800px;">
                    <!-- Linke Sidebar -->
                    <div style="width: 300px; display: flex; flex-direction: column; gap: 15px;">
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üèÜ Rangliste</h3>
                            <div id="elFinalePlayersList" style="max-height: 400px; overflow-y: auto;"></div>
                        </div>
                        
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">‚ö° Punkte-Steuerung</h3>
                            <select id="selectedPlayer" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 8px; color: white; font-size: 1rem; margin-bottom: 10px;">
                                ${elFinalePlayers.map((p, i) => `<option value="${i}" style="background: #1a1f3a; color: white;">${p.name}</option>`).join('')}
                            </select>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button onclick="adjustElFinalePoints(50)" class="control-btn-full" style="background: rgba(34, 197, 94, 0.3); border-color: rgba(34, 197, 94, 0.5);">+50</button>
                                <button onclick="adjustElFinalePoints(100)" class="control-btn-full" style="background: rgba(34, 197, 94, 0.3); border-color: rgba(34, 197, 94, 0.5);">+100</button>
                                <button onclick="adjustElFinalePoints(-50)" class="control-btn-full" style="background: rgba(239, 68, 68, 0.3); border-color: rgba(239, 68, 68, 0.5);">-50</button>
                                <button onclick="adjustElFinalePoints(-100)" class="control-btn-full" style="background: rgba(239, 68, 68, 0.3); border-color: rgba(239, 68, 68, 0.5);">-100</button>
                            </div>
                        </div>

                        <button class="control-btn-full danger" onclick="endElFinale()">üèÅ Spiel beenden</button>
                        <button class="control-btn-full" onclick="toggleElFinaleImport()" id="toggleImportBtn" style="background: rgba(124, 58, 237, 0.3); border-color: rgba(124, 58, 237, 0.5);">
                            üì• Import-Modus
                        </button>
                    </div>

                    <!-- Spielfeld -->
                    <div style="flex: 1; overflow-y: auto; padding-bottom: 30px;">
                        <div id="elFinaleBoard"></div>
                    </div>
                </div>

                <!-- Karteikarten Modal -->
                <div id="elFinaleCardModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; justify-content: center; align-items: center;">
                    <div id="elFinaleCard" style="background: linear-gradient(135deg, #1a1f3a 0%, #0a0e27 100%); border: 3px solid #ffd700; border-radius: 20px; padding: 50px; max-width: 720px; width: 90%; min-height: 480px; display: flex; flex-direction: column; justify-content: space-between; position: relative; box-shadow: 0 20px 60px rgba(255, 215, 0, 0.3);">
                        <div id="elFinaleCardContent"></div>
                    </div>
                </div>
            `;

            updateElFinalePlayersList();
            renderElFinaleBoard();
        }

        function renderElFinaleBoard() {
            const board = document.getElementById('elFinaleBoard');
            
            // Bestimme welche Kategorien angezeigt werden (0-4 oder 5-9)
            const startIndex = currentElFinalePage === 1 ? 0 : 5;
            const endIndex = currentElFinalePage === 1 ? 5 : 10;
            const categoriesOnPage = elFinaleCategories.slice(startIndex, endIndex);
            
            board.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; padding: 20px;">
                    ${categoriesOnPage.map((cat, localIndex) => {
                        const catIndex = startIndex + localIndex;
                        const points = cat.isDouble ? [200, 400, 600, 800, 1000] : [100, 200, 300, 400, 500];
                        
                        return `
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="background: linear-gradient(135deg, ${cat.isDouble ? '#ff8c00' : '#ffd700'} 0%, ${cat.isDouble ? '#ff6b00' : '#ff8c00'} 100%); padding: 15px; border-radius: 12px; text-align: center; font-weight: 700; color: #000; font-size: 1.1rem;">
                                    ${cat.name}${cat.isDouble ? ' üî•' : ''}
                                </div>
                                ${points.map((pointValue, pointIndex) => `
                                    <button 
                                        id="question-${catIndex}-${pointIndex}" 
                                        onclick="openElFinaleQuestion(${catIndex}, ${pointIndex}, ${pointValue})"
                                        style="background: rgba(124, 58, 237, 0.3); border: 2px solid rgba(124, 58, 237, 0.5); border-radius: 12px; padding: 20px; color: white; font-size: 1.5rem; font-weight: 700; cursor: pointer; transition: all 0.3s; min-height: 80px;"
                                        onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(124, 58, 237, 0.8)';"
                                        onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(124, 58, 237, 0.5)';"
                                    >
                                        ${pointValue}
                                    </button>
                                `).join('')}
                                
                                <!-- Import-Bereich f√ºr diese Kategorie -->
                                <div class="el-finale-import-area" style="display: none; background: rgba(255, 215, 0, 0.1); border: 2px dashed rgba(255, 215, 0, 0.3); border-radius: 12px; padding: 15px; margin-top: 10px; margin-bottom: 20px;">
                                    <div style="text-align: center; margin-bottom: 10px; color: #ffd700; font-weight: 600; font-size: 0.9rem;">
                                        üì• Import f√ºr ${cat.name}
                                    </div>
                                    <input type="file" id="import-${catIndex}" accept=".txt" style="display: none;" onchange="handleElFinaleImport(event, ${catIndex})">
                                    <button onclick="document.getElementById('import-${catIndex}').click()" style="width: 100%; padding: 12px; background: rgba(124, 58, 237, 0.3); border: 2px solid rgba(124, 58, 237, 0.5); border-radius: 8px; color: white; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 600;">
                                        üìÑ Textdatei w√§hlen
                                    </button>
                                    <div id="import-status-${catIndex}" style="margin-top: 8px; text-align: center; font-size: 0.8rem; color: rgba(255, 255, 255, 0.7); min-height: 20px;"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <!-- Seitenauswahl (nur im Import-Modus sichtbar) -->
                <div id="elFinalePageSelector" class="el-finale-import-area" style="display: none; text-align: center; padding: 20px; margin: 0 auto; max-width: 500px;">
                    <h3 style="color: #ffd700; font-size: 1.2rem; margin-bottom: 15px;">üìÑ Kategorien-Seiten</h3>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="switchElFinalePage(1)" id="pageBtn1" style="flex: 1; padding: 15px 30px; background: rgba(124, 58, 237, 0.5); border: 2px solid rgba(124, 58, 237, 0.8); border-radius: 12px; color: white; cursor: pointer; font-size: 1.1rem; font-weight: 700; transition: all 0.3s;">
                            Seite 1<br><span style="font-size: 0.9rem; opacity: 0.8;">(100-500)</span>
                        </button>
                        <button onclick="switchElFinalePage(2)" id="pageBtn2" style="flex: 1; padding: 15px 30px; background: rgba(124, 58, 237, 0.3); border: 2px solid rgba(124, 58, 237, 0.5); border-radius: 12px; color: white; cursor: pointer; font-size: 1.1rem; font-weight: 700; transition: all 0.3s;">
                            Seite 2 üî•<br><span style="font-size: 0.9rem; opacity: 0.8;">(200-1000)</span>
                        </button>
                    </div>
                </div>
            `;
            
            // Aktualisiere bereits verwendete Fragen
            usedQuestions.forEach(key => {
                const btn = document.getElementById(`question-${key}`);
                if (btn) {
                    btn.style.background = 'rgba(100, 100, 100, 0.3)';
                    btn.style.borderColor = 'rgba(100, 100, 100, 0.5)';
                    btn.style.cursor = 'not-allowed';
                    btn.style.opacity = '0.5';
                    btn.onclick = null;
                    btn.onmouseover = null;
                    btn.onmouseout = null;
                }
            });
        }

        function switchElFinalePage(page) {
            currentElFinalePage = page;
            
            // Update Button-Styles
            const btn1 = document.getElementById('pageBtn1');
            const btn2 = document.getElementById('pageBtn2');
            
            if (page === 1) {
                btn1.style.background = 'rgba(124, 58, 237, 0.5)';
                btn1.style.borderColor = 'rgba(124, 58, 237, 0.8)';
                btn2.style.background = 'rgba(124, 58, 237, 0.3)';
                btn2.style.borderColor = 'rgba(124, 58, 237, 0.5)';
            } else {
                btn1.style.background = 'rgba(124, 58, 237, 0.3)';
                btn1.style.borderColor = 'rgba(124, 58, 237, 0.5)';
                btn2.style.background = 'rgba(124, 58, 237, 0.5)';
                btn2.style.borderColor = 'rgba(124, 58, 237, 0.8)';
            }
            
            renderElFinaleBoard();
        }

        function updateElFinalePlayersList() {
            const container = document.getElementById('elFinalePlayersList');
            if (!container) return;

            const sorted = [...elFinalePlayers].sort((a, b) => b.score - a.score);
            
            container.innerHTML = sorted.map((player, index) => {
                const isTop3 = index < 3;
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const scoreColor = player.score < 0 ? 'color: #ef4444;' : player.score > 0 ? 'color: #22c55e;' : '';
                
                return `
                    <div class="game-player-item" style="${isTop3 ? 'background: rgba(255, 215, 0, 0.2); border-color: rgba(255, 215, 0, 0.4);' : ''}">
                        <span class="game-player-name">${isTop3 ? medals[index] + ' ' : ''}${player.name}</span>
                        <span class="game-player-score" style="${scoreColor}">${player.score}</span>
                    </div>
                `;
            }).join('');
        }

        function adjustElFinalePoints(points) {
            const selectEl = document.getElementById('selectedPlayer');
            const playerIndex = parseInt(selectEl.value);
            
            elFinalePlayers[playerIndex].score += points;
            updateElFinalePlayersList();
        }

        function openElFinaleQuestion(catIndex, pointIndex, points) {
            const questionKey = `${catIndex}-${pointIndex}`;
            
            const modal = document.getElementById('elFinaleCardModal');
            const card = document.getElementById('elFinaleCard');
            const cardContent = document.getElementById('elFinaleCardContent');
            
            // Hole Frage aus importierten Daten oder nutze Platzhalter
            const category = elFinaleCategories[catIndex];
            const questionData = category.questions[pointIndex];
            
            const question = questionData?.question || `Hier steht die Frage f√ºr ${category.name} (${points} Punkte)`;
            
            // Zeige Frage-Seite
            cardContent.innerHTML = `
                <div style="text-align: center;">
                    <div style="background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); color: #000; padding: 10px 20px; border-radius: 8px; display: inline-block; font-weight: 700; font-size: 1.2rem; margin-bottom: 30px;">
                        ${points} Punkte
                    </div>
                    <h2 style="color: #ffd700; font-size: 2rem; margin-bottom: 30px;">Frage</h2>
                    <p style="font-size: 1.3rem; line-height: 1.8; color: white; margin-bottom: 40px;">
                        ${question}
                    </p>
                </div>
                <button onclick="showElFinaleSolution(${catIndex}, ${pointIndex}, ${points})" class="save-config-btn" style="width: 100%; background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);">
                    üí° L√∂sung anzeigen
                </button>
            `;
            
            // Zoom-In Animation
            card.classList.remove('card-zoom-out');
            card.classList.add('card-zoom-in');
            
            modal.style.display = 'flex';
        }

        function showElFinaleSolution(catIndex, pointIndex, points) {
            const cardContent = document.getElementById('elFinaleCardContent');
            
            // Hole Frage und Antwort aus importierten Daten oder nutze Platzhalter
            const category = elFinaleCategories[catIndex];
            const questionData = category.questions[pointIndex];
            
            const question = questionData?.question || `Hier steht die Frage f√ºr ${category.name} (${points} Punkte)`;
            const answer = questionData?.answer || 'Hier steht die Antwort';
            
            // Zeige Antwort-Seite
            cardContent.innerHTML = `
                <div style="text-align: center;">
                    <div style="background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); color: #000; padding: 10px 20px; border-radius: 8px; display: inline-block; font-weight: 700; font-size: 1.2rem; margin-bottom: 20px;">
                        ${points} Punkte
                    </div>
                    <h3 style="color: rgba(255, 255, 255, 0.7); font-size: 1.2rem; margin-bottom: 10px;">Frage:</h3>
                    <p style="font-size: 1.1rem; color: rgba(255, 255, 255, 0.8); margin-bottom: 30px;">
                        ${question}
                    </p>
                    <div style="border-top: 2px solid #ffd700; padding-top: 20px;">
                        <h2 style="color: #22c55e; font-size: 2rem; margin-bottom: 20px;">‚úì Antwort</h2>
                        <p style="font-size: 1.3rem; line-height: 1.8; color: white;">
                            ${answer}
                        </p>
                    </div>
                </div>
                <button onclick="closeElFinaleCard(${catIndex}, ${pointIndex})" class="save-config-btn" style="width: 100%; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    ‚úï Schlie√üen
                </button>
            `;
        }

        function closeElFinaleCard(catIndex, pointIndex) {
            const questionKey = `${catIndex}-${pointIndex}`;
            usedQuestions.add(questionKey);
            
            // Graut den Button aus
            const btn = document.getElementById(`question-${catIndex}-${pointIndex}`);
            if (btn) {
                btn.style.background = 'rgba(100, 100, 100, 0.3)';
                btn.style.borderColor = 'rgba(100, 100, 100, 0.5)';
                btn.style.cursor = 'not-allowed';
                btn.style.opacity = '0.5';
                btn.onclick = null;
                btn.onmouseover = null;
                btn.onmouseout = null;
            }
            
            // Zoom-Out Animation
            const card = document.getElementById('elFinaleCard');
            const modal = document.getElementById('elFinaleCardModal');
            
            card.classList.remove('card-zoom-in');
            card.classList.add('card-zoom-out');
            
            // Schlie√üe Modal nach Animation
            setTimeout(() => {
                modal.style.display = 'none';
                card.classList.remove('card-zoom-out');
            }, 250);
        }

        function endElFinale() {
            if (!confirm('M√∂chtest du das Spiel wirklich beenden?')) return;
            
            const modalBody = document.getElementById('modalBody');
            const sorted = [...elFinalePlayers].sort((a, b) => b.score - a.score);
            const maxScore = sorted[0]?.score || 0;
            
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 40px;">
                    <h2 style="font-size: 3rem; margin-bottom: 30px; background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">üèÜ EL FINALE - Endergebnis</h2>
                    
                    <div style="max-width: 600px; margin: 0 auto;">${sorted.map((player, index) => {
                            const isWinner = player.score === maxScore && maxScore > 0;
                            const rank = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                            const scoreColor = player.score < 0 ? 'color: #ef4444;' : player.score > 0 ? 'color: #22c55e;' : '';
                            
                            return `
                                <div class="final-player-item ${isWinner ? 'winner' : ''}" style="${isWinner ? 'background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%); border-color: #ffd700;' : ''}">
                                    <span class="final-player-rank">${rank}</span>
                                    <span class="final-player-name">${player.name}</span>
                                    <span class="final-player-score" style="${scoreColor}">${player.score} Punkte</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <button class="save-config-btn" onclick="closeModal()" style="margin-top: 40px; background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); color: #000;">
                        Zur√ºck zur √úbersicht
                    </button>
                </div>
            `;
        }

        function toggleElFinaleImport() {
            const importAreas = document.querySelectorAll('.el-finale-import-area');
            const toggleBtn = document.getElementById('toggleImportBtn');
            const pageSelector = document.getElementById('elFinalePageSelector');
            
            const isHidden = importAreas[0].style.display === 'none';
            
            importAreas.forEach(area => {
                if (isHidden) {
                    area.style.display = 'block';
                } else {
                    area.style.display = 'none';
                }
            });
            
            if (isHidden) {
                toggleBtn.textContent = 'üì§ Import-Modus beenden';
                toggleBtn.style.background = 'rgba(239, 68, 68, 0.3)';
                toggleBtn.style.borderColor = 'rgba(239, 68, 68, 0.5)';
            } else {
                toggleBtn.textContent = 'üì• Import-Modus';
                toggleBtn.style.background = 'rgba(124, 58, 237, 0.3)';
                toggleBtn.style.borderColor = 'rgba(124, 58, 237, 0.5)';
            }
        }

        function handleElFinaleImport(event, catIndex) {
            const file = event.target.files[0];
            if (!file) return;

            const statusEl = document.getElementById(`import-status-${catIndex}`);
            statusEl.textContent = 'üì§ Lade...';
            statusEl.style.color = '#ffd700';

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim() !== '');
                
                // Erwarte Format: 
                // Kategorie-Name
                // Frage 1
                // Antwort 1
                // Frage 2
                // Antwort 2
                // ... (5 Frage-Antwort-Paare)

                if (lines.length < 11) {
                    statusEl.textContent = '‚ùå Fehler: Zu wenig Zeilen (min. 11 ben√∂tigt)';
                    statusEl.style.color = '#ef4444';
                    return;
                }

                // Erste Zeile ist Kategorie-Name
                const categoryName = lines[0].trim();
                elFinaleCategories[catIndex].name = categoryName;

                // Bestimme Punktwerte basierend auf Kategorie-Typ
                const isDouble = elFinaleCategories[catIndex].isDouble;
                const pointValues = isDouble ? [200, 400, 600, 800, 1000] : [100, 200, 300, 400, 500];

                // Die n√§chsten 10 Zeilen sind 5 Frage-Antwort-Paare
                elFinaleCategories[catIndex].questions = [];
                for (let i = 0; i < 5; i++) {
                    const questionIndex = 1 + (i * 2);
                    const answerIndex = 2 + (i * 2);
                    
                    if (questionIndex < lines.length && answerIndex < lines.length) {
                        elFinaleCategories[catIndex].questions.push({
                            question: lines[questionIndex].trim(),
                            answer: lines[answerIndex].trim(),
                            points: pointValues[i]
                        });
                    }
                }

                // Speichere in LocalStorage
                saveElFinaleCategories();

                // Aktualisiere Anzeige
                renderElFinaleBoard();

                statusEl.textContent = `‚úì ${categoryName} geladen (${elFinaleCategories[catIndex].questions.length} Fragen)`;
                statusEl.style.color = '#22c55e';

                // Reset File Input
                event.target.value = '';
            };

            reader.onerror = function() {
                statusEl.textContent = '‚ùå Fehler beim Lesen der Datei';
                statusEl.style.color = '#ef4444';
            };

            reader.readAsText(file);
        }

        // ========================================
        // SPIEL 5: Sch√§tzen, sch√§tzen und sch√§tzen
        // ========================================
        
        let estimateRounds = 0;
        let estimateCurrentRound = 0;
        let estimatePlayers = [];
        let estimateRoundHistory = []; // Speichert Gewinner pro Runde

        function openSchaetzenSpiel() {
            if (players.length < 2) {
                alert('Du brauchst mindestens 2 Spieler!');
                return;
            }

            const modal = document.getElementById('gameModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalIcon.textContent = 'ü§î';
            modalTitle.textContent = 'Sch√§tzen, sch√§tzen und raten';

            // Spielregeln anzeigen
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 60px 80px; position: relative;">
                    <div style="position: absolute; top: 20px; right: 20px; opacity: 0.3;"><img src="Logo/buzzer.jpg" alt="Buzzer" style="width: 80px; height: auto;"></div>
                    
                    <div style="font-size: 4rem; margin-bottom: 20px;">ü§î</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Sch√§tzen, sch√§tzen und raten</h2>
                    
                    <div style="text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #ffffff;">üìã Spielregeln</h3>
                        <ul style="list-style: none; padding: 0; font-size: 1.1rem; line-height: 2; color: rgba(255, 255, 255, 0.9);">
                            <li style="margin-bottom: 12px;">‚úÖ Buzzer-Spiel - euer Handy wird ben√∂tigt</li>
                            <li style="margin-bottom: 12px;">‚úÖ Timer auf der Homepage</li>
                            <li style="margin-bottom: 12px;">‚úÖ Wer am Ende die meisten Punkte hat gewinnt das Spiel</li>
                        </ul>
                    </div>

                    <button class="save-config-btn" onclick="setupEstimateGame()" style="font-size: 1.2rem; padding: 18px 50px;">
                        ‚úì Verstanden, weiter!
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function setupEstimateGame() {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div class="config-section" style="text-align: center; padding: 80px 60px;">
                    <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #ffffff;">Wie viele Runden?</h2>
                    
                    <div class="round-input-container">
                        <label for="roundsInput">Anzahl der Runden:</label>
                        <input type="number" id="roundsInput" class="round-input" min="1" max="50" value="10">
                    </div>

                    <button class="save-config-btn" onclick="startEstimateGame()" style="font-size: 1.2rem; padding: 18px 50px; margin-top: 40px;">
                        üéÆ Spiel starten!
                    </button>
                </div>
            `;
        }

        function startEstimateGame() {
            const roundsInput = document.getElementById('roundsInput');
            estimateRounds = parseInt(roundsInput.value) || 10;
            estimateCurrentRound = 1;
            estimateRoundHistory = []; // Reset Historie
            
            // Kopiere Spieler mit eigenen Punkten
            estimatePlayers = players.map(p => ({
                name: p.name,
                score: 0
            }));

            showEstimateRound();
        }

        // Toggle L√∂sung anzeigen
        function toggleSolution() {
            showSolution = !showSolution;
            const button = document.getElementById('solutionButton');
            
            if (showSolution) {
                button.textContent = 'üîí L√∂sung verbergen';
                button.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                button.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                console.log('üí° L√∂sung wird angezeigt');
            } else {
                button.textContent = 'üí° L√∂sung anzeigen';
                button.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                button.style.borderColor = 'rgba(34, 197, 94, 0.5)';
                console.log('üîí L√∂sung verborgen');
            }
            
            updateEstimateDisplay();
        }
        
        function showEstimateRound() {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; gap: 20px; height: 100%; min-height: 700px;">
                    <!-- Linke Sidebar mit Bestenliste -->
                    <div style="width: 350px; display: flex; flex-direction: column; gap: 15px;">
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üèÜ Bestenliste</h3>
                            <div id="estimateLeaderboard">
                            </div>
                        </div>

                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üìä Spielinfo</h3>
                            <div class="info-row">
                                <span class="info-label">Runde:</span>
                                <span class="info-value">${estimateCurrentRound} / ${estimateRounds}</span>
                            </div>
                            <div class="info-row" style="margin-top: 10px;">
                                <span class="info-label">Room Code:</span>
                                <span class="info-value" style="color: #fbbf24;">QUIZ</span>
                            </div>
                            <div class="info-row" style="margin-top: 10px;">
                                <span class="info-label">Jeans joint als:</span>
                                <span class="info-value" style="color: #22c55e;">Moderator</span>
                            </div>
                        </div>

                        ${estimateRoundHistory.length > 0 ? `
                        <div class="info-card">
                            <h3 style="margin-bottom: 15px; font-size: 1.3rem;">üìù Runden-Historie</h3>
                            <div style="max-height: 96px; overflow-y: auto;">
                                ${estimateRoundHistory.map((round, index) => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; margin-bottom: 8px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                                            R${index + 1}: ${round.winner || 'Niemand'}
                                        </span>
                                        <button onclick="editRoundWinner(${index})" style="background: rgba(124, 58, 237, 0.3); border: 1px solid rgba(124, 58, 237, 0.5); border-radius: 6px; color: white; padding: 4px 8px; cursor: pointer; font-size: 0.8rem; transition: all 0.3s ease;">
                                            ‚úèÔ∏è
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Rechter Bereich mit Rundenkarte und LIVE SCH√ÑTZUNGEN -->
                    <div style="flex: 1; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; position: relative; padding-top: 40px;">
                        
                        <!-- Runde und Live-Sch√§tzungen nebeneinander -->
                        <div style="display: flex; gap: 30px; align-items: flex-start; width: 100%; max-width: 900px;">
                            <!-- Rundenkarte (links) -->
                            <div class="estimate-card" style="flex-shrink: 0;">
                                <div class="estimate-round-number">${estimateCurrentRound}</div>
                                <div class="estimate-round-label">Runde ${estimateCurrentRound}</div>
                            </div>
                            
                            <!-- LIVE SCH√ÑTZUNGEN CONTAINER (rechts) -->
                            <div id="buzzerEstimatesContainer" style="flex: 1; min-width: 0;"></div>
                        </div>

                        <div style="margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                            <button onclick="toggleSolution()" id="solutionButton" style="
                                background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); 
                                border: 2px solid rgba(34, 197, 94, 0.5);
                                color: white;
                                padding: 12px 24px;
                                border-radius: 12px;
                                font-size: 1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                gap: 8px;
                            ">
                                üí° L√∂sung anzeigen
                            </button>
                            <button class="next-round-btn" onclick="showEstimateWinnerSelection()">
                                ‚ñ∂Ô∏è Rundengewinner ausw√§hlen
                            </button>
                        </div>
                    </div>
                </div>
            `;

            updateEstimateLeaderboard();
            
            // VERBINDE MIT BUZZER-APP
            if (typeof connectToBuzzerApp === 'function') {
                connectToBuzzerApp('QUIZ');
            }
        }

        function updateEstimateLeaderboard() {
            const container = document.getElementById('estimateLeaderboard');
            
            if (!container) return;

            // Sortiere nach Punkten
            const sorted = [...estimatePlayers].sort((a, b) => b.score - a.score);

            container.innerHTML = sorted.map((player, index) => {
                const isTop3 = index < 3;
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                
                return `
                    <div class="game-player-item" style="${isTop3 ? 'background: rgba(124, 58, 237, 0.2); border-color: rgba(124, 58, 237, 0.4);' : ''}">
                        <span class="game-player-name">
                            ${isTop3 ? medals[index] + ' ' : ''}${player.name}
                        </span>
                        <span class="game-player-score">${player.score}</span>
                    </div>
                `;
            }).join('');
        }

        function showEstimatesModal() {
            // Debug-Ausgabe
            console.log('üîç showEstimatesModal aufgerufen');
            console.log('üìä estimateData exists:', typeof estimateData !== 'undefined');
            console.log('üìä estimateData size:', typeof estimateData !== 'undefined' ? estimateData.size : 'undefined');
            console.log('üìä estimateData content:', typeof estimateData !== 'undefined' ? Array.from(estimateData.entries()) : 'undefined');
            
            // Hole alle aktuellen Sch√§tzungen
            if (typeof estimateData === 'undefined') {
                alert('‚ö†Ô∏è Fehler: estimateData nicht initialisiert!\n\nBitte stelle sicher, dass die Buzzer-Integration geladen wurde.');
                console.error('‚ùå estimateData ist undefined!');
                return;
            }
            
            if (estimateData.size === 0) {
                alert('‚ö†Ô∏è Noch keine Sch√§tzungen vorhanden!\n\nSpieler m√ºssen erst ihre Sch√§tzungen in der Buzzer-App eingeben.\n\nRoom Code: QUIZ\nURL: jeans.up.railway.app\n\nüí° Tipp: √ñffne die Console (F12) um zu sehen ob Sch√§tzungen empfangen werden.');
                console.warn('‚ö†Ô∏è estimateData ist leer (size = 0)');
                return;
            }
            
            // Konvertiere Map zu Array und sortiere
            const estimates = Array.from(estimateData.entries())
                .sort((a, b) => b[1] - a[1]); // H√∂chste zuerst
            
            console.log('‚úÖ Zeige', estimates.length, 'Sch√§tzungen im Modal');
            
            // Erstelle Modal-Overlay
            const overlay = document.createElement('div');
            overlay.id = 'estimatesModalOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                animation: fadeIn 0.3s ease-out;
            `;
            
            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
                    border-radius: 24px;
                    padding: 40px;
                    max-width: 700px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                    border: 2px solid rgba(124, 58, 237, 0.3);
                    position: relative;
                ">
                    <button onclick="closeEstimatesModal()" style="
                        position: absolute;
                        top: 20px;
                        right: 20px;
                        background: rgba(239, 68, 68, 0.2);
                        border: 2px solid rgba(239, 68, 68, 0.5);
                        color: white;
                        border-radius: 50%;
                        width: 40px;
                        height: 40px;
                        font-size: 1.5rem;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='rgba(239, 68, 68, 0.4)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
                        ‚úï
                    </button>
                    
                    <h2 style="
                        font-size: 2.5rem;
                        margin-bottom: 30px;
                        text-align: center;
                        color: #ffffff;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 15px;
                    ">
                        üìä Alle Sch√§tzungen
                        <span style="
                            font-size: 1rem;
                            background: rgba(34, 197, 94, 0.2);
                            border: 2px solid rgba(34, 197, 94, 0.5);
                            padding: 8px 16px;
                            border-radius: 20px;
                            color: #22c55e;
                        ">
                            ${estimates.length} Spieler
                        </span>
                    </h2>
                    
                    <div style="display: grid; gap: 15px;">
                        ${estimates.map(([playerName, estimate], index) => {
                            const medals = ['ü•á', 'ü•à', 'ü•â'];
                            const icon = index < 3 ? medals[index] : (index + 1);
                            const isTopThree = index < 3;
                            
                            return `
                                <div style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 20px 25px;
                                    background: ${isTopThree ? 
                                        (index === 0 ? 'linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%)' :
                                         index === 1 ? 'linear-gradient(135deg, rgba(192, 192, 192, 0.2) 0%, rgba(156, 163, 175, 0.2) 100%)' :
                                         'linear-gradient(135deg, rgba(205, 127, 50, 0.2) 0%, rgba(180, 83, 9, 0.2) 100%)') :
                                        'linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%)'
                                    };
                                    border: 2px solid ${isTopThree ? 
                                        (index === 0 ? '#fbbf24' : index === 1 ? '#c0c0c0' : '#cd7f32') :
                                        'rgba(124, 58, 237, 0.4)'
                                    };
                                    border-radius: 16px;
                                    animation: slideInEstimate 0.3s ease-out;
                                    animation-delay: ${index * 0.05}s;
                                    animation-fill-mode: both;
                                    box-shadow: ${isTopThree ? '0 4px 12px rgba(0, 0, 0, 0.3)' : 'none'};
                                ">
                                    <div style="display: flex; align-items: center; gap: 20px;">
                                        <span style="
                                            font-size: 2.5rem;
                                            min-width: 60px;
                                            text-align: center;
                                        ">
                                            ${typeof icon === 'string' ? icon : `<span style="font-size: 1.3rem; color: rgba(255,255,255,0.6);">#${icon}</span>`}
                                        </span>
                                        <div>
                                            <div style="
                                                font-weight: 700;
                                                font-size: 1.4rem;
                                                color: #ffffff;
                                                margin-bottom: 5px;
                                            ">
                                                ${playerName}
                                            </div>
                                            <div style="
                                                font-size: 0.9rem;
                                                color: rgba(255, 255, 255, 0.6);
                                            ">
                                                Platz ${index + 1} von ${estimates.length}
                                            </div>
                                        </div>
                                    </div>
                                    <div style="
                                        font-weight: 700;
                                        font-size: 2rem;
                                        color: #fbbf24;
                                        text-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
                                    ">
                                        ${estimate.toLocaleString('de-DE')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 15px;">
                        <button onclick="exportEstimatesToConsole()" style="
                            flex: 1;
                            padding: 15px 30px;
                            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
                            border: 2px solid rgba(99, 102, 241, 0.5);
                            color: white;
                            border-radius: 12px;
                            font-size: 1.1rem;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            üìã In Console ausgeben
                        </button>
                        <button onclick="closeEstimatesModal()" style="
                            flex: 1;
                            padding: 15px 30px;
                            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
                            border: 2px solid rgba(124, 58, 237, 0.5);
                            color: white;
                            border-radius: 12px;
                            font-size: 1.1rem;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            ‚úì Schlie√üen
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }
        
        function closeEstimatesModal() {
            const overlay = document.getElementById('estimatesModalOverlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => overlay.remove(), 300);
            }
        }
        
        function exportEstimatesToConsole() {
            if (typeof estimateData === 'undefined' || estimateData.size === 0) {
                console.log('Keine Sch√§tzungen vorhanden');
                return;
            }
            
            const estimates = Array.from(estimateData.entries())
                .sort((a, b) => b[1] - a[1]);
            
            console.log('='.repeat(50));
            console.log('üìä SCH√ÑTZUNGEN - RUNDE ' + estimateCurrentRound);
            console.log('='.repeat(50));
            estimates.forEach(([name, estimate], index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '  ';
                console.log(`${medal} #${index + 1} - ${name}: ${estimate.toLocaleString('de-DE')}`);
            });
            console.log('='.repeat(50));
            
            alert('‚úÖ Sch√§tzungen wurden in die Console ausgegeben!\n\nDr√ºcke F12 um die Console zu √∂ffnen.');
        }
        
        function debugBuzzerConnection() {
            console.log('üîç DEBUG INFO - BUZZER CONNECTION');
            console.log('='.repeat(50));
            console.log('WebSocket Status:', buzzerWs ? buzzerWs.readyState : 'nicht initialisiert');
            console.log('  - 0 = CONNECTING');
            console.log('  - 1 = OPEN ‚úÖ');
            console.log('  - 2 = CLOSING');
            console.log('  - 3 = CLOSED');
            console.log('');
            console.log('Room Code:', currentRoomCode || 'nicht gesetzt');
            console.log('');
            console.log('estimateData existiert:', typeof estimateData !== 'undefined');
            console.log('estimateData.size:', typeof estimateData !== 'undefined' ? estimateData.size : 'undefined');
            console.log('estimateData Inhalt:', typeof estimateData !== 'undefined' ? Array.from(estimateData.entries()) : 'undefined');
            console.log('='.repeat(50));
            
            let status = '';
            if (!buzzerWs) {
                status = '‚ùå WebSocket nicht verbunden!\n\n';
                status += 'üí° L√∂sung:\n';
                status += '1. Schlie√üe Spiel 5\n';
                status += '2. √ñffne Spiel 5 neu\n';
                status += '3. Verbindung sollte automatisch hergestellt werden';
            } else if (buzzerWs.readyState === 1) {
                status = '‚úÖ WebSocket verbunden!\n\n';
                status += `Room Code: ${currentRoomCode}\n`;
                status += `Sch√§tzungen: ${estimateData.size}\n\n`;
                if (estimateData.size === 0) {
                    status += '‚ö†Ô∏è Aber keine Sch√§tzungen empfangen.\n\n';
                    status += 'üí° M√∂gliche Ursachen:\n';
                    status += '1. Spieler haben noch nichts eingegeben\n';
                    status += '2. Falscher Room Code\n';
                    status += '3. Spieler sind in anderem Room\n\n';
                    status += 'üîß Pr√ºfe:\n';
                    status += '- Buzzer-App: jeans.up.railway.app/schaetzen.html\n';
                    status += '- Room muss "QUIZ" sein\n';
                    status += '- Spieler m√ºssen "Fertig" dr√ºcken\n\n';
                    status += 'üí° Klicke "üîÑ Daten aktualisieren"';
                } else {
                    status += '‚úÖ Alles funktioniert!\n';
                    status += `${estimateData.size} Sch√§tzung(en) vorhanden`;
                }
            } else {
                status = '‚ö†Ô∏è WebSocket getrennt!\n\n';
                status += 'Reconnect l√§uft automatisch...';
            }
            
            alert('üîç DEBUG INFO\n\n' + status + '\n\nDetails in Console (F12)');
        }
        
        function requestEstimatesUpdate() {
            console.log('üîÑ Fordere Spielerliste manuell an...');
            
            // STRATEGIE 1: Pr√ºfe ob WebSocket Nachrichten empf√§ngt
            console.log('WebSocket Status:', buzzerWs ? buzzerWs.readyState : 'nicht initialisiert');
            
            if (!buzzerWs || buzzerWs.readyState !== 1) {
                alert('‚ùå WebSocket nicht verbunden!\n\nBitte √∂ffne Spiel 5 neu.');
                return;
            }
            
            // STRATEGIE 2: Versuche HTTP API (falls vorhanden)
            console.log('üì° Versuche HTTP API...');
            fetch(`https://jeans.up.railway.app/api/estimates/${currentRoomCode}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('API nicht verf√ºgbar');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('‚úÖ Daten von API empfangen:', data);
                    
                    // Verarbeite API-Daten
                    if (data.players) {
                        data.players.forEach(player => {
                            if (player.answered && player.answer !== undefined && player.answer !== '') {
                                const estimate = parseFloat(player.answer) || 0;
                                estimateData.set(player.name, estimate);
                                console.log(`  ‚úÖ Geladen: ${player.name} = ${estimate}`);
                            }
                        });
                        
                        updateEstimateDisplay();
                        
                        if (estimateData.size > 0) {
                            alert(`‚úÖ Update erfolgreich!\n\n${estimateData.size} Sch√§tzung(en) empfangen.\n\nDu kannst jetzt "üìä Sch√§tzungen anzeigen" klicken.`);
                        } else {
                            alert('‚ö†Ô∏è Keine Sch√§tzungen vorhanden.\n\nSpieler m√ºssen in der Buzzer-App:\n1. Zahl eingeben\n2. "Fertig" dr√ºcken');
                        }
                    }
                })
                .catch(error => {
                    console.log('‚ö†Ô∏è HTTP API nicht verf√ºgbar:', error.message);
                    
                    // STRATEGIE 3: WebSocket Trick - simuliere Spieler-Update
                    console.log('üì° Versuche WebSocket Trick...');
                    
                    // Sende "ready" um Server-Update zu triggern
                    buzzerWs.send(JSON.stringify({
                        type: 'guessing_ready',
                        roomCode: currentRoomCode
                    }));
                    
                    console.log('üì§ guessing_ready gesendet');
                    
                    // Warte auf Antwort
                    setTimeout(() => {
                        if (estimateData.size > 0) {
                            alert(`‚úÖ Update erfolgreich!\n\n${estimateData.size} Sch√§tzung(en) empfangen.\n\nDu kannst jetzt "üìä Sch√§tzungen anzeigen" klicken.`);
                        } else {
                            // STRATEGIE 4: Zeige manuelle Anleitung
                            alert(`‚ö†Ô∏è Automatisches Update nicht m√∂glich.\n\nüéØ MANUELLE L√ñSUNG:\n\n1. Spieler √∂ffnen Buzzer-App:\n   jeans.up.railway.app/schaetzen.html\n\n2. Room: QUIZ\n\n3. Zahl eingeben ‚Üí "Fertig" dr√ºcken\n\n4. In dieser Quiz-App:\n   - Schau Console (F12)\n   - Bei "Fertig" sollte erscheinen:\n     "‚úÖ Gespeichert: Name = Zahl"\n\n5. Dann funktioniert "Sch√§tzungen anzeigen"!\n\nüí° Tipp: Console (F12) zeigt dir live\nwenn Sch√§tzungen ankommen.`);
                        }
                    }, 1500);
                });
        }


        function showEstimateWinnerSelection() {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 700px; padding: 40px;">
                    <div style="max-width: 800px; width: 100%;">
                        <div class="winner-title" style="margin-bottom: 30px;">üèÜ Wer hat Runde ${estimateCurrentRound} gewonnen?</div>
                        
                        <div class="winner-players">
                            ${estimatePlayers.map((player, index) => `
                                <button class="winner-player-btn" onclick="selectEstimateWinner(${index})">
                                    ${player.name}
                                </button>
                            `).join('')}
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <button class="no-winner-btn" onclick="selectEstimateWinner(null)">
                                Niemand hat gewonnen
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function selectEstimateWinner(playerIndex) {
            const winnerName = playerIndex !== null ? estimatePlayers[playerIndex].name : null;
            
            // Speichere Gewinner in Historie
            estimateRoundHistory.push({
                roundNumber: estimateCurrentRound,
                winner: winnerName,
                winnerIndex: playerIndex
            });

            if (playerIndex !== null) {
                estimatePlayers[playerIndex].score += 1;
            }

            estimateCurrentRound++;

            if (estimateCurrentRound > estimateRounds) {
                // Pr√ºfe auf Punktgleichstand
                checkForTiebreaker();
            } else {
                showEstimateRound();
            }
        }

        // Pr√ºfe ob es einen Gleichstand gibt
        function checkForTiebreaker() {
            // Sortiere Spieler nach Punkten
            const sorted = [...estimatePlayers].sort((a, b) => b.score - a.score);
            const maxScore = sorted[0]?.score || 0;
            
            // Finde alle Spieler mit der h√∂chsten Punktzahl
            const topPlayers = estimatePlayers.filter(p => p.score === maxScore);
            
            if (topPlayers.length > 1 && maxScore > 0) {
                // Es gibt einen Gleichstand!
                showTiebreakerScreen(topPlayers);
            } else {
                // Kein Gleichstand, zeige Endergebnis
                showEstimateFinalResults();
            }
        }

        // Zeige Stichentscheid-Screen
        function showTiebreakerScreen(tiedPlayers) {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 700px; padding: 40px;">
                    <div style="max-width: 900px; width: 100%; text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">‚ö°</div>
                        <h2 style="font-size: 2.5rem; margin-bottom: 20px; color: #ffffff; font-weight: 700;">
                            Punktgleichstand!
                        </h2>
                        <p style="font-size: 1.3rem; color: rgba(255, 255, 255, 0.8); margin-bottom: 40px;">
                            Folgende Spieler haben jeweils <strong style="color: #7c3aed;">${tiedPlayers[0].score} Punkte</strong>:
                        </p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
                            ${tiedPlayers.map(player => `
                                <div style="background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%); border: 2px solid #7c3aed; border-radius: 16px; padding: 30px 20px;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üèÜ</div>
                                    <div style="color: #ffffff; font-size: 1.5rem; font-weight: 700;">${player.name}</div>
                                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 1.1rem; margin-top: 5px;">${player.score} Punkte</div>
                                </div>
                            `).join('')}
                        </div>

                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                            <p style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.9); line-height: 1.8;">
                                Es wird eine <strong style="color: #7c3aed;">Stichentscheid-Runde</strong> gespielt!<br>
                                Der Gewinner dieser Runde gewinnt das gesamte Spiel.
                            </p>
                        </div>

                        <button class="next-round-btn" onclick="startTiebreakerRound(${JSON.stringify(tiedPlayers.map(p => p.name)).replace(/"/g, '&quot;')})" style="font-size: 1.3rem; padding: 20px 50px;">
                            ‚ö° Stichentscheid starten!
                        </button>
                    </div>
                </div>
            `;
        }

        // Starte Stichentscheid-Runde
        function startTiebreakerRound(playerNames) {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 700px; padding: 40px;">
                    <div style="max-width: 800px; width: 100%; display: flex; flex-direction: column; align-items: center;">
                        <div class="estimate-card" style="margin-bottom: 40px;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">‚ö°</div>
                            <div class="estimate-round-label" style="font-size: 2.5rem;">Stichentscheid</div>
                        </div>

                        <button class="next-round-btn" onclick="showTiebreakerWinnerSelection(${JSON.stringify(playerNames).replace(/"/g, '&quot;')})">
                            Gewinner des Stichentscheids ausw√§hlen
                        </button>
                    </div>
                </div>
            `;
        }

        // Zeige Gewinner-Auswahl f√ºr Stichentscheid
        function showTiebreakerWinnerSelection(playerNames) {
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 700px; padding: 40px;">
                    <div style="max-width: 800px; width: 100%;">
                        <div class="winner-title" style="margin-bottom: 30px;">‚ö° Wer hat den Stichentscheid gewonnen?</div>
                        
                        <div class="winner-players">
                            ${playerNames.map(name => `
                                <button class="winner-player-btn" onclick="selectTiebreakerWinner('${name}')">
                                    ${name}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // W√§hle Gewinner des Stichentscheids
        function selectTiebreakerWinner(winnerName) {
            // Finde den Gewinner und gib ihm einen Extra-Punkt f√ºr den Stichentscheid
            const winner = estimatePlayers.find(p => p.name === winnerName);
            if (winner) {
                winner.score += 1;
                
                // Speichere Stichentscheid in Historie
                estimateRoundHistory.push({
                    roundNumber: 'Stichentscheid',
                    winner: winnerName,
                    winnerIndex: estimatePlayers.findIndex(p => p.name === winnerName)
                });
            }
            
            // Zeige Endergebnis
            showEstimateFinalResults();
        }

        // Rundengewinner bearbeiten
        function editRoundWinner(roundIndex) {
            const round = estimateRoundHistory[roundIndex];
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 700px; padding: 40px;">
                    <div style="max-width: 800px; width: 100%;">
                        <div class="winner-title" style="margin-bottom: 20px;">‚úèÔ∏è Gewinner von Runde ${round.roundNumber} √§ndern</div>
                        <p style="text-align: center; color: rgba(255, 255, 255, 0.7); margin-bottom: 30px; font-size: 1.1rem;">
                            Aktueller Gewinner: <strong style="color: #7c3aed;">${round.winner || 'Niemand'}</strong>
                        </p>
                        
                        <div class="winner-players">
                            ${estimatePlayers.map((player, index) => `
                                <button class="winner-player-btn ${round.winnerIndex === index ? 'winner' : ''}" onclick="updateRoundWinner(${roundIndex}, ${index})">
                                    ${player.name}
                                </button>
                            `).join('')}
                        </div>

                        <div style="text-align: center; margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                            <button class="no-winner-btn" onclick="updateRoundWinner(${roundIndex}, null)">
                                Niemand hat gewonnen
                            </button>
                            <button class="control-btn-full" onclick="showEstimateRound()" style="width: auto; padding: 12px 30px;">
                                Abbrechen
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateRoundWinner(roundIndex, newWinnerIndex) {
            const round = estimateRoundHistory[roundIndex];
            const oldWinnerIndex = round.winnerIndex;
            
            // Entferne Punkt vom alten Gewinner
            if (oldWinnerIndex !== null) {
                estimatePlayers[oldWinnerIndex].score -= 1;
            }
            
            // F√ºge Punkt zum neuen Gewinner hinzu
            if (newWinnerIndex !== null) {
                estimatePlayers[newWinnerIndex].score += 1;
            }
            
            // Aktualisiere Historie
            round.winnerIndex = newWinnerIndex;
            round.winner = newWinnerIndex !== null ? estimatePlayers[newWinnerIndex].name : null;
            
            // Zur√ºck zur Rundenansicht
            showEstimateRound();
        }

        function showEstimateFinalResults() {
            const modalBody = document.getElementById('modalBody');
            
            // Sortiere Spieler nach Punkten
            const sorted = [...estimatePlayers].sort((a, b) => b.score - a.score);
            const maxScore = sorted[0]?.score || 0;

            modalBody.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 700px; padding: 40px;">
                    <div class="final-results">
                        <h3 style="font-size: 2rem; margin-bottom: 30px;">üéâ Spielende - Ergebnisse</h3>
                        ${sorted.map((player, index) => {
                            const isWinner = player.score === maxScore && maxScore > 0;
                            const rank = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                            
                            return `
                                <div class="final-player-item ${isWinner ? 'winner' : ''}">
                                    <span class="final-player-rank">${rank}</span>
                                    <span class="final-player-name">${player.name}</span>
                                    <span class="final-player-score">${player.score} Punkte</span>
                                </div>
                            `;
                        }).join('')}
                        <button class="next-round-btn" onclick="closeModal()" style="margin-top: 30px; width: 100%;">
                            Zur√ºck zur √úbersicht
                        </button>
                    </div>
                </div>
            `;
        }

        // Modal schlie√üen
        function closeModal() {
            const modal = document.getElementById('gameModal');
            modal.classList.remove('active');
            
            // Disconnect von Buzzer-App wenn verbunden
            if (typeof disconnectBuzzerApp === 'function') {
                disconnectBuzzerApp();
                console.log('üîå QuizDisplay disconnected beim Schlie√üen');
            }
            
            // Stoppe alle laufenden Animationen
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            
            // Reset alle Spiel-Variablen
            uploadedImages = [];
            currentRoundIndex = 0;
            gamePlayers = [];
            uploadedAudioFiles = [];
            cantinaBandPlayers = [];
            currentAudioIndex = 0;
            showSongName = false;
            if (audioElement) {
                audioElement.pause();
                audioElement = null;
            }
            if (audioUpdateInterval) {
                clearInterval(audioUpdateInterval);
                audioUpdateInterval = null;
            }
            isAudioPlaying = false;
            tournamentBracket = [];
            tournamentRoundIndex = 0;
            einlochenBracket = [];
            einlochenRoundIndex = 0;
            estimateRounds = 0;
            estimateCurrentRound = 0;
            estimatePlayers = [];
            estimateRoundHistory = [];
            
            // Reset Modal-Inhalt wird beim n√§chsten √ñffnen neu gesetzt
            // Keine Manipulation des modalBody hier, da es beim √ñffnen √ºberschrieben wird
        }

        // Schlie√üe Modal bei Klick au√üerhalb
        document.getElementById('gameModal').addEventListener('click', function(e) {
            if (e.target === this) {
                if (confirm('M√∂chtest du das Spiel wirklich verlassen?')) {
                    closeModal();
                }
            }
        });

        // ESC-Taste zum Schlie√üen
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('gameModal').classList.contains('active')) {
                    if (confirm('M√∂chtest du das Spiel wirklich verlassen?')) {
                        closeModal();
                    }
                }
            }
        });

        // Beim Laden der Seite
        window.addEventListener('load', () => {
            console.log('Spiele-√úbersicht geladen');
            
            // Versuche gespeicherte Spieler zu laden
            const hasStoredPlayers = loadPlayers();
            
            // F√ºge vordefinierte Spieler nur hinzu, wenn keine gespeichert sind
            if (!hasStoredPlayers && players.length === 0) {
                const defaultPlayers = ['Marcel', 'Marco', 'Josh', 'Fabi', 'Bobi', 'Gmyre'];
                defaultPlayers.forEach(name => {
                    players.push({
                        name: name,
                        score: 0
                    });
                });
                savePlayers(); // Speichere die Standard-Spieler
            }
            
            updatePlayersList();
        });

        // Start Screen Animation
        function startQuizShow() {
            const startScreen = document.getElementById('startScreen');
            const animationScreen = document.getElementById('animationScreen');
            const mainContent = document.getElementById('mainContent');
            const backgroundMusic = document.getElementById('backgroundMusic');
            
            // Stoppe und fade out Hintergrundmusik
            let musicVolume = backgroundMusic.volume;
            const fadeOutInterval = setInterval(() => {
                if (backgroundMusic.volume > 0.05) {
                    backgroundMusic.volume = Math.max(0, backgroundMusic.volume - 0.05);
                } else {
                    backgroundMusic.volume = 0;
                    backgroundMusic.pause();
                    clearInterval(fadeOutInterval);
                }
            }, 50);
            
            // Fade out start screen
            startScreen.classList.add('hidden');
            
            // Show animation screen after start screen fades out
            setTimeout(() => {
                animationScreen.classList.add('active');
            }, 500);
            
            // Hide animation screen and show main content after 5 seconds
            setTimeout(() => {
                animationScreen.classList.add('fadeout');
                
                // Show main content
                setTimeout(() => {
                    mainContent.classList.add('visible');
                }, 500);
            }, 5500); // 500ms start fade + 5000ms animation
        }

        // Playlist-System f√ºr Hintergrundmusik
        const songPlaylist = [
            'Song/song1.mp3',
            'Song/song2.mp3'
        ];

        let currentSongIndex = -1;
        let shuffledPlaylist = [];
        let musicStarted = false;

        // Playlist mischen
        function shufflePlaylist() {
            shuffledPlaylist = [...songPlaylist];
            for (let i = shuffledPlaylist.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledPlaylist[i], shuffledPlaylist[j]] = [shuffledPlaylist[j], shuffledPlaylist[i]];
            }
            currentSongIndex = 0;
        }

        // N√§chsten Song abspielen
        function playNextSong() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            
            if (currentSongIndex >= shuffledPlaylist.length) {
                // Playlist zu Ende - neu mischen und von vorne beginnen
                shufflePlaylist();
            }
            
            backgroundMusic.src = shuffledPlaylist[currentSongIndex];
            backgroundMusic.load();
            backgroundMusic.volume = 0.3;
            
            console.log(`üéµ Spiele ab: ${shuffledPlaylist[currentSongIndex]}`);
            
            const playPromise = backgroundMusic.play();
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('‚úÖ Musik spielt erfolgreich');
                        musicStarted = true;
                    })
                    .catch(error => {
                        console.log('‚ö†Ô∏è Auto-Play blockiert - Klicke auf die Seite:', error.message);
                    });
            }
            
            currentSongIndex++;
        }

        // Auto-play Hintergrundmusik beim Laden der Seite
        window.addEventListener('DOMContentLoaded', () => {
            const backgroundMusic = document.getElementById('backgroundMusic');
            
            console.log('üéÆ Quiz Duel geladen - Initialisiere Musik...');
            
            // Initialisiere Playlist
            shufflePlaylist();
            
            // Event-Listener: N√§chster Song wenn aktueller endet
            backgroundMusic.addEventListener('ended', () => {
                console.log('üéµ Song beendet - Spiele n√§chsten...');
                playNextSong();
            });
            
            // Fehler-Listener
            backgroundMusic.addEventListener('error', (e) => {
                console.error('‚ùå Fehler beim Laden des Songs:', e);
                console.log('Versuche n√§chsten Song...');
                playNextSong(); // Versuche n√§chsten Song
            });
            
            // Versuche ersten Song zu starten
            setTimeout(() => {
                playNextSong();
            }, 1000); // Warte 1 Sekunde nach Animation
            
            // Fallback: Starte bei erstem Klick falls Auto-Play blockiert
            const startOnClick = () => {
                if (!musicStarted) {
                    console.log('üëÜ Benutzer-Klick erkannt - Starte Musik...');
                    playNextSong();
                }
            };
            
            document.body.addEventListener('click', startOnClick, { once: true });
            document.body.addEventListener('touchstart', startOnClick, { once: true });
        });
    </script>
    
    <script>
// ===========================================
// BUZZER-APP WEBSOCKET INTEGRATION
// Verbindet Quiz-App mit https://jeans.up.railway.app
// ===========================================

const BUZZER_APP_URL = 'wss://jeans.up.railway.app';
let buzzerWs = null;
let currentRoomCode = null;
let estimateData = new Map(); // playerName -> answer
let reconnectAttempts = 0;
const MAX_RECONNECT_ATTEMPTS = 5;
let autoAnswerTimeout = null; // Timeout f√ºr Auto-Antwort
let autoReadyTimeout = null; // Timeout f√ºr Auto-Ready
let showSolution = false; // Ob Moderator-L√∂sung angezeigt wird
let intentionalDisconnect = false; // Flag f√ºr absichtliches Disconnect

// Verbindung zur Buzzer-App herstellen
function connectToBuzzerApp(roomCode = 'QUIZ') {
    currentRoomCode = roomCode;
    intentionalDisconnect = false; // Reset bei neuem Connect
    reconnectAttempts = 0; // Reset reconnect counter
    
    console.log('üîó Verbinde mit Buzzer-App...');
    console.log('üì° WebSocket URL:', BUZZER_APP_URL);
    console.log('üö™ Room Code:', roomCode);
    
    try {
        buzzerWs = new WebSocket(BUZZER_APP_URL);
        
        buzzerWs.onopen = () => {
            console.log('‚úÖ WebSocket verbunden!');
            reconnectAttempts = 0;
            
            // Als Spieler im Guessing Game joinen
            console.log('üì§ Sende guessing_join:', {
                type: 'guessing_join',
                room: currentRoomCode,
                playerName: 'QuizDisplay'
            });
            
            buzzerWs.send(JSON.stringify({
                type: 'guessing_join',
                room: currentRoomCode,
                playerName: 'QuizDisplay'
            }));
            
            showBuzzerStatus('Mit Buzzer-App verbunden', 'success');
        };
        
        buzzerWs.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                console.log('üì© RAW MESSAGE:', event.data);
                console.log('üì© PARSED:', data);
                handleBuzzerMessage(data);
            } catch (error) {
                console.error('‚ùå Fehler beim Parsen der Nachricht:', error);
                console.error('   Raw data:', event.data);
            }
        };
        
        buzzerWs.onerror = (error) => {
            console.error('‚ùå WebSocket Fehler:', error);
            showBuzzerStatus('Verbindungsfehler', 'error');
        };
        
        buzzerWs.onclose = () => {
            console.log('‚ö†Ô∏è WebSocket getrennt');
            
            // Kein Reconnect wenn absichtlich disconnected
            if (intentionalDisconnect) {
                console.log('‚úÖ Intentional disconnect - kein Reconnect');
                showBuzzerStatus('Getrennt', 'info');
                return;
            }
            
            showBuzzerStatus('Verbindung getrennt', 'warning');
            
            // Auto-Reconnect nur bei unbeabsichtigter Trennung
            if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
                reconnectAttempts++;
                console.log(`üîÑ Reconnect-Versuch ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS}...`);
                setTimeout(() => connectToBuzzerApp(currentRoomCode), 2000);
            }
        };
        
    } catch (error) {
        console.error('‚ùå Fehler beim Verbinden:', error);
        showBuzzerStatus('Verbindung fehlgeschlagen', 'error');
    }
}

// Nachrichten von Buzzer-App verarbeiten
function handleBuzzerMessage(data) {
    console.log('üì© Nachricht empfangen:', data.type, data);
    
    switch(data.type) {
        case 'guessing_joined':
            console.log('‚úÖ Erfolgreich beigetreten:', data);
            
            // Automatisch ready setzen
            console.log('üì§ Setze automatisch ready...');
            buzzerWs.send(JSON.stringify({
                type: 'guessing_ready'
            }));
            
            showBuzzerStatus('Bereit zum Empfangen von Sch√§tzungen', 'success');
            break;
            
        case 'guessing_playerList':
            // Alle Spieler mit ihren Antworten
            console.log('üë• Spielerliste empfangen:', data.players);
            updatePlayerList(data.players);
            break;
            
        case 'guessing_answer':
            // Einzelne Antwort empfangen (wird normalerweise nicht direkt gesendet)
            if (data.playerName && data.answer !== undefined) {
                estimateData.set(data.playerName, parseFloat(data.answer) || 0);
                console.log(`üìä ${data.playerName} sch√§tzt: ${data.answer}`);
                console.log('üíæ Aktuelle estimateData:', Array.from(estimateData.entries()));
                updateEstimateDisplay();
                showNewEstimateNotification(data.playerName, data.answer);
            }
            break;
            
        case 'guessing_gameStart':
            console.log('üéÆ Spiel gestartet!');
            estimateData.clear();
            showSolution = false; // L√∂sung verbergen bei neuer Runde
            
            // Button zur√ºcksetzen
            const solutionButton = document.getElementById('solutionButton');
            if (solutionButton) {
                solutionButton.textContent = 'üí° L√∂sung anzeigen';
                solutionButton.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                solutionButton.style.borderColor = 'rgba(34, 197, 94, 0.5)';
            }
            
            updateEstimateDisplay();
            
            // L√∂sche altes Timeout falls vorhanden
            if (autoAnswerTimeout) {
                clearTimeout(autoAnswerTimeout);
            }
            
            // QuizDisplay sendet automatisch 0 nach 2-3 Sekunden
            const randomDelay = 2000 + Math.random() * 1000; // 2-3 Sekunden
            console.log(`‚è±Ô∏è QuizDisplay wird in ${Math.round(randomDelay/1000)}s automatisch 0 senden...`);
            
            autoAnswerTimeout = setTimeout(() => {
                if (buzzerWs && buzzerWs.readyState === 1) {
                    console.log('üì§ QuizDisplay sendet automatisch Antwort: 0');
                    buzzerWs.send(JSON.stringify({
                        type: 'guessing_answer',
                        answer: '0'
                    }));
                    autoAnswerTimeout = null;
                }
            }, randomDelay);
            break;
            
        case 'guessing_gameEnd':
            console.log('üèÅ Spiel beendet! Results:', data.results);
            
            // Verarbeite results Array
            if (data.results && Array.isArray(data.results)) {
                data.results.forEach(result => {
                    if (result.name && result.answer) {
                        // Entferne Komma und konvertiere zu Number
                        const answer = result.answer.replace(',', '.');
                        const estimate = parseFloat(answer) || 0;
                        estimateData.set(result.name, estimate);
                        console.log(`  ‚úÖ Result: ${result.name} = ${estimate}`);
                    }
                });
                
                console.log('üìä Finale Sch√§tzungen:', Array.from(estimateData.entries()));
                updateEstimateDisplay();
                
                // Zeige Notification
                if (estimateData.size > 0) {
                    showBuzzerStatus(`üèÅ Spiel beendet! ${estimateData.size} Sch√§tzungen verf√ºgbar`, 'success');
                }
            }
            
            // KEIN Auto-Ready hier! 
            // Host muss manuell "N√§chste Runde" dr√ºcken
            // Dann kommt guessing_nextRound Event
            break;
            
        case 'guessing_nextRound':
            console.log('üîÑ N√§chste Runde');
            estimateData.clear();
            updateEstimateDisplay();
            
            // L√∂sche alte Ready-Timeouts
            if (autoReadyTimeout) {
                clearTimeout(autoReadyTimeout);
            }
            
            // Bei neuer Runde: Setze QuizDisplay automatisch ready
            autoReadyTimeout = setTimeout(() => {
                if (buzzerWs && buzzerWs.readyState === 1) {
                    console.log('üì§ QuizDisplay setzt sich bereit f√ºr Runde...');
                    buzzerWs.send(JSON.stringify({
                        type: 'guessing_ready'
                    }));
                    autoReadyTimeout = null;
                }
            }, 1000);
            break;
            
        case 'guessing_countdown':
            console.log('‚è±Ô∏è Countdown gestartet');
            break;
            
        case 'guessing_timeSet':
            console.log('‚è±Ô∏è Zeit gesetzt:', data.time);
            break;
            
        default:
            console.log('‚ùì Unbekannter Message-Type:', data.type);
    }
}

// Spielerliste aktualisieren
function updatePlayerList(players) {
    console.log('üë• Spieler aktualisiert:', players.length);
    
    if (!players || players.length === 0) {
        console.warn('‚ö†Ô∏è Keine Spieler in der Liste');
        return;
    }
    
    // Aktualisiere Sch√§tzungen von allen Spielern die geantwortet haben
    let updatedCount = 0;
    players.forEach(player => {
        console.log(`  - ${player.name}: answered=${player.answered}, answer=${player.answer}`);
        if (player.answered && player.answer !== undefined && player.answer !== '') {
            const estimate = parseFloat(player.answer) || 0;
            estimateData.set(player.name, estimate);
            updatedCount++;
            console.log(`    ‚úÖ Gespeichert: ${player.name} = ${estimate}`);
        }
    });
    
    console.log(`üíæ ${updatedCount} Sch√§tzungen gespeichert`);
    console.log('üìä Aktuelle estimateData:', Array.from(estimateData.entries()));
    
    updateEstimateDisplay();
}

// Sch√§tzungen im UI anzeigen
function updateEstimateDisplay() {
    const container = document.getElementById('buzzerEstimatesContainer');
    if (!container) {
        console.warn('‚ö†Ô∏è Container "buzzerEstimatesContainer" nicht gefunden');
        return;
    }
    
    // Konvertiere Map zu Array
    // Filtere: QuizDisplay und Moderator (au√üer showSolution ist true)
    let estimates = Array.from(estimateData.entries())
        .filter(([playerName]) => playerName !== 'QuizDisplay'); // QuizDisplay immer raus
    
    // Moderator/Host nur anzeigen wenn L√∂sung aktiviert
    let moderatorAnswer = null;
    if (!showSolution) {
        // Finde und entferne Moderator
        const moderatorIndex = estimates.findIndex(([playerName]) => playerName === 'Moderator');
        if (moderatorIndex !== -1) {
            moderatorAnswer = estimates[moderatorIndex];
            estimates.splice(moderatorIndex, 1);
        }
    }
    
    // KEINE Sortierung - zeige in Reihenfolge wie sie ankamen
    
    if (estimates.length === 0 && !showSolution) {
        container.innerHTML = `
            <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: #ffffff;">
                    üìä Live-Sch√§tzungen
                </h3>
                <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">
                    Warte auf Sch√§tzungen...<br>
                    <span style="font-size: 0.8rem;">Room: ${currentRoomCode}</span>
                </p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = `
        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px;">
            <h3 style="font-size: 1.1rem; margin-bottom: 12px; color: #ffffff; display: flex; align-items: center; gap: 8px;">
                üìä ${showSolution ? 'Sch√§tzungen + L√∂sung' : 'Live-Sch√§tzungen'}
                <span style="font-size: 0.85rem; color: #22c55e; background: rgba(34, 197, 94, 0.2); padding: 3px 10px; border-radius: 12px;">
                    ${estimates.length}${showSolution && moderatorAnswer ? ' + L√∂sung' : ''}
                </span>
            </h3>
            <div style="display: grid; gap: 8px;">
                ${estimates.map(([playerName, estimate]) => {
                    return `
                        <div style="
                            display: flex; 
                            justify-content: space-between; 
                            align-items: center; 
                            padding: 10px 15px; 
                            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
                            border: 1.5px solid rgba(124, 58, 237, 0.4);
                            border-radius: 10px;
                            animation: slideInEstimate 0.3s ease-out;
                        ">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">üë§</span>
                                <div>
                                    <div style="font-weight: 700; font-size: 1rem; color: #ffffff;">${playerName}</div>
                                </div>
                            </div>
                            <div style="font-weight: 700; font-size: 1.3rem; color: #fbbf24;">
                                ${estimate.toLocaleString('de-DE')}
                            </div>
                        </div>
                    `;
                }).join('')}
                
                ${showSolution && moderatorAnswer ? `
                    <div style="
                        display: flex; 
                        justify-content: space-between; 
                        align-items: center; 
                        padding: 12px 18px; 
                        background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(16, 185, 129, 0.3) 100%);
                        border: 2px solid rgba(34, 197, 94, 0.6);
                        border-radius: 10px;
                        animation: slideInEstimate 0.5s ease-out;
                        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
                    ">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.8rem;">üí°</span>
                            <div>
                                <div style="font-weight: 700; font-size: 1.1rem; color: #22c55e;">${moderatorAnswer[0]}</div>
                                <div style="font-size: 0.8rem; color: rgba(34, 197, 94, 0.8);">Richtige L√∂sung</div>
                            </div>
                        </div>
                        <div style="font-weight: 700; font-size: 1.5rem; color: #22c55e;">
                            ${moderatorAnswer[1].toLocaleString('de-DE')}
                        </div>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Notification f√ºr neue Sch√§tzung
function showNewEstimateNotification(playerName, estimate) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        padding: 20px 30px;
        background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
        color: white;
        border-radius: 12px;
        font-weight: 600;
        z-index: 10001;
        box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
        animation: slideInRight 0.3s ease-out;
        border: 2px solid rgba(255, 255, 255, 0.2);
    `;
    notification.innerHTML = `
        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px;">Neue Sch√§tzung</div>
        <div style="font-size: 1.3rem; font-weight: 700;">${playerName}</div>
        <div style="font-size: 1.8rem; color: #fbbf24; margin-top: 8px;">${parseFloat(estimate).toLocaleString('de-DE')}</div>
    `;
    document.body.appendChild(notification);
    
    // Sound abspielen (optional)
    playNotificationSound();
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Status-Anzeige
function showBuzzerStatus(message, type = 'info') {
    const colors = {
        success: '#22c55e',
        error: '#ef4444',
        warning: '#fbbf24',
        info: '#3b82f6'
    };
    
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        background: ${colors[type]};
        color: white;
        border-radius: 8px;
        font-weight: 600;
        z-index: 10002;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideInRight 0.3s ease-out;
    `;
    notification.textContent = `üîó ${message}`;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Notification Sound
function playNotificationSound() {
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBzbM9NBycSYFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBzbM9NBycSYFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAo=');
    audio.volume = 0.2;
    audio.play().catch(() => {}); // Ignoriere Fehler
}

// Sch√§tzungen zur√ºcksetzen (f√ºr neue Runde)
function resetEstimates() {
    estimateData.clear();
    updateEstimateDisplay();
    
    if (buzzerWs && buzzerWs.readyState === WebSocket.OPEN) {
        buzzerWs.send(JSON.stringify({
            type: 'guessing_nextRound'
        }));
    }
    
    console.log('üîÑ Sch√§tzungen zur√ºckgesetzt');
}

// Verbindung trennen
function disconnectBuzzerApp() {
    intentionalDisconnect = true; // Markiere als absichtlich
    
    if (buzzerWs && buzzerWs.readyState === 1) {
        // Sende Leave-Message vor dem Disconnect
        try {
            buzzerWs.send(JSON.stringify({
                type: 'guessing_leave',
                room: currentRoomCode
            }));
            console.log('üì§ QuizDisplay verl√§sst Room:', currentRoomCode);
        } catch (error) {
            console.warn('‚ö†Ô∏è Konnte Leave-Message nicht senden:', error);
        }
        
        buzzerWs.close();
    }
    
    // Cleanup
    buzzerWs = null;
    estimateData.clear();
    showSolution = false;
    
    // Cleane Timeouts
    if (autoAnswerTimeout) {
        clearTimeout(autoAnswerTimeout);
        autoAnswerTimeout = null;
    }
    if (autoReadyTimeout) {
        clearTimeout(autoReadyTimeout);
        autoReadyTimeout = null;
    }
    
    updateEstimateDisplay();
    console.log('üëã QuizDisplay disconnected (intentional)');
}

// Room Code √§ndern
function changeRoomCode(newRoomCode) {
    disconnectBuzzerApp();
    setTimeout(() => connectToBuzzerApp(newRoomCode), 500);
}

// CSS Animationen hinzuf√ºgen
if (!document.getElementById('buzzer-animations')) {
    const style = document.createElement('style');
    style.id = 'buzzer-animations';
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes slideInEstimate {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .estimate-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .estimate-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }
    `;
    document.head.appendChild(style);
}

console.log('‚úÖ Buzzer WebSocket Integration geladen');
console.log('üì° Bereit zum Verbinden mit:', BUZZER_APP_URL);
    </script>
</body>
</html>
